{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Application Detail - Expense | Smart Office</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link href="{% static 'create_expense/css/elegant-icons-style.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"/>
    <link rel="stylesheet" href="{% static 'create_expense/style.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.5/css/bootstrap-select.min.css"
          rel="stylesheet">
    <link rel="stylesheet" href="{% static 'office_app/css/chat.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-mentions-input@1.6.0/jquery.mentionsInput.min.css">

    <style>

        .popcontent {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0, 0, 0); /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        input[type="checkbox"] {
            -webkit-appearance: initial;
            appearance: initial;
            background: #dddddd;
            width: 35px;
            height: 35px;
            position: relative;
            border-radius: 5px;
            margin-top: 0;
            border-color: #0275d8;
        }

        input[type="checkbox"]:checked {
            background-color: #0275d8;
        }

        input[type="checkbox"]:checked:after {
            content: "X";
            color: white;
            position: absolute;
            left: 50%;
            top: 50%;
            border-radius: 5px;
            -webkit-transform: rotate(0deg) scale(1);
            -moz-transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
            transition: all 0.3s ease-out;

        }

        .icon-pencil:hover {
            color: black;
        }

    </style>
</head>

<body>

{% if show_chat %}
    <div class="container chat-container">
        <div class="row">
            <div class="chat-block col-md-3">
                <div class="card card-primary text-secondary">
                    <div class="card-header p-2" id="accordion">
                        <i id="chat-badge" class="fas fa-comment pl-2"></i> Chat
                        <div class="btn-group float-right pr-2">
                            <a type="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                                <i id="toggle_icon" class="fas fa-arrow-down"></i>
                            </a>
                        </div>
                    </div>
                    <div class="card-collapse collapse show" id="collapseOne">
                        <div class="card-header text-center text-info p-1">Chat for PR Form: {{ form_id }}</div>
                        <div id="chat-body" class="card-body card-body-chat">
                            <ul class="chat" id="chat_list"></ul>
                        </div>
                        <div class="card-footer p-2">
                            <div class="input-group" style="flex-wrap: nowrap">
                                <textarea id="chat-input" class="mention"
                                          placeholder="Type your message here..."></textarea>
                                <i class="btn fas fa-level-down-alt text-primary" id="chat-scroll"
                                   title="Auto scroll on new message"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}

<!-- Multi step form -->
<section class="multi_step_form">
    <form method="post" id="msform" action="{% url 'process' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <!-- Tittle -->
        <div class="tittle">
            <h1>Expense Application Details</h1>
        </div>

        <!--menu bar-->
        <nav class="navbar navbar-expand-lg navbar-light bg-light rounded nav nav-tabs">
            <a class="ml-5 h7">Welcome, {{ request.session.full_name }} !</a>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'smart_office_dashboard' %}">Smart Office</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'dashboard' %}" >Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'add_expense_without_modelform' %}" >Create Expense</a>
                    </li>
                    <li class="nav-item mr-sm-2">
                        <a class="nav-link" href="../History">View My Expense</a>
                    </li>
                    <li class="nav-item mr-sm-2">
                        <a class="nav-link" href="../ExpenseToApprove">Approve Expense</a>
                    </li>
                    <li class="nav-item mr-sm-2">
                        <a href="{% url 'logout' %}" class="nav-link text-danger">Log Out</a>
                    </li>
                </ul>
            </div>
        </nav>

        <fieldset>

            <div class="mb-3">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Expense Information
                            </header>
                            <div class="card-body bg-white">
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <label for="expense_requester">Requester:</label>
                                        <input type="text" class="form-control" id="expense_requester"
                                               name="expense_requester" value="{{ expense.requester }}" readonly>
                                    </div>

                                    <div class="form-group col-md-4">
                                        <label for="expense_ID">Form ID:</label>
                                        <input type="text" class="form-control" id="expense_ID" name="expense_ID"
                                               value="{{ expense.form_ID }}" readonly>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="request_date">Request Date</label>
                                        <input class="form-control" type="text" name="expense_request_date"
                                               id="request_date" value="{{ expense.request_Date }}" readonly>

                                    </div>
                                    {% if role == "accountant" %}
                                        <div class="form-group col-md-4">
                                            <label for="doc_header">Document Header:</label>
                                            <input type="text" class="form-control" id="doc_header" name="doc_header"
                                                   maxlength="64" value="{{ expense.document_Header }}">
                                        </div>
                                    {% endif %}


                                    <div class="form-group col-md-4">
                                        <label for="payment_date">Invoice Date</label>
                                        {% if role == "accountant" or role == "CM" %}
                                            <input type="date" class="form-control" id="payment_date"
                                                   name="expense_payment_date"
                                                   value="{{ expense.payment_Date | date:'Y-m-d' }}"
                                                   required>
                                        {% else %}
                                            <input class="form-control" type="text" name="expense_payment_date"
                                                   value="{{ expense.payment_Date }}" readonly>
                                        {% endif %}
                                    </div>

                                    <div class="form-group col-md-4">
                                        <label for="expense_company">Company:</label>
                                        <input type="text" class="form-control" name="expense_company"
                                               id="expense_company"
                                               value="{{ expense.company }}" readonly>
                                    </div>

                                    <div class="form-group col-md-4">
                                        <label for="expense_BU">Business Unit:</label>
                                        <input type="text" class="form-control" name="expense_BU" id="expense_BU"
                                               value="{{ expense.BU }}" readonly>
                                    </div>

                                    <div class="form-group col-md-4">
                                        <label for="expense_invoice_ID">Invoice ID:</label>
                                        {% if role == "accountant" or role == "CM" %}
                                            <input type="text" class="form-control" name="expense_invoice_ID"
                                                   id="expense_invoice_ID" maxlength="20"
                                                   value="{{ expense.invoice_ID }}" required>
                                        {% else %}
                                            <input type="text" class="form-control" name="expense_invoice_ID"
                                                   value="{{ expense.invoice_ID }}" readonly/>
                                        {% endif %}
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="vendor">Vendor Name:</label>
                                        {% if role == "accountant" or role == "CM" %}
                                            <select class="selectpicker form-control" data-live-search="true"
                                                    style="height: auto" name="vendor" id="vendor" required>
                                                {% for vendor in vendors %}
                                                    {{ expense.vendor.vendorName }}
                                                    {% if vendor.id == expense.vendor.id %}
                                                        <option value="{{ vendor.id }}"
                                                                selected="selected"
                                                                data-tokens="{{ vendor.vendorName }}">{{ vendor.vendorName }}
                                                            -- {{ vendor.vendorCode }}</option>
                                                    {% else %}
                                                        <option value="{{ vendor.id }}"
                                                                data-tokens="{{ vendor.vendorName }}">{{ vendor.vendorName }}
                                                            -- {{ vendor.vendorCode }}</option>
                                                    {% endif %}
                                                {% endfor %}
                                            </select>
                                        {% else %}
                                            <input class="form-control" type="text" name="expense_vendor"
                                                   id="expense_vendor" value="{{ expense.vendor }}" readonly/>
                                        {% endif %}
                                    </div>

                                    <div class="form-group col-md-4">
                                        <label for="tax_rate">Sales Tax Rate %:</label>
                                        <input type="number" class="form-control" name="expense_tax_Rate"
                                               id="tax_rate" value="{% widthratio expense.tax_Rate 1 100 %}"
                                               readonly/>
                                    </div>

                                    <div class="form-group col-md-4">
                                        <label for="expense_sales_Tax_Amount">Sales Tax Amount:</label>
                                        <input type="number" class="form-control" name="expense_sales_Tax_Amount"
                                               id="expense_sales_Tax_Amount" value="{{ expense.sales_Tax_Amount }}"
                                               readonly/>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="expense_shipping_Cost">Shipping Cost:</label>
                                        <input type="number" class="form-control" name="expense_shipping_Cost"
                                               id="expense_shipping_Cost" value="{{ expense.shipping_Cost }}" readonly/>
                                    </div>

                                    <div class="form-group col-md-4">
                                        <label for="expense_ground_Total">Ground Total:</label>
                                        <input type="number" class="form-control" name="expense_ground_Total"
                                               id="expense_ground_Total" value="{{ expense.ground_Total }}" readonly/>
                                    </div>
                                    <div class="form-group col-md-4"></div>
                                    {% if role == "accountant" or role == "CM" %}
                                        <div class="form-group col-md-4">
                                            <label for="currency">Currency:</label><br/>
                                            <select class="selectpicker form-control" name="currency" id="currency"
                                                    data-live-search="true" required>
                                                {% for currency in currencies %}
                                                    {% if currency.name == expense.currency %}
                                                        <option value="{{ currency.name }}"
                                                                selected="selected">{{ currency }}</option>
                                                    {% else %}
                                                        <option value="{{ currency.name }}">{{ currency }}</option>
                                                    {% endif %}
                                                {% endfor %}

                                            </select>
                                        </div>
                                    {% else %}
                                        <div class="form-group col-md-4">
                                            <label for="expense_currency">Currency:</label>
                                            <input type="text" class="form-control" name="expense_currency"
                                                   id="expense_currency" value="{{ expense.currency }}" readonly/>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                        </section>
                    </div>
                </div>
            </div>


            <div class="mb-3">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">

                            <header class="card-header bg-foxconn">
                                Item Information
                            </header>
                            <div class="card-body bg-white">


                                <div class="table-responsive">

                                    <!--Table-->
                                    <table class="table table-striped">
                                        <!--Table head-->
                                        <thead>
                                        <tr>
                                            <th>Item Name</th>
                                            <th>Description</th>
                                            <th>Amount</th>
                                            <th>Cost Center</th>
                                            <th>Active Status</th>
                                        </tr>
                                        </thead>
                                        <!--Table head-->

                                        <!--Table body-->
                                        <tbody id="expense_item">
                                        {% for item in expense.expenseitem_set.all %}
                                            <input type="hidden" class="form-control" name="item_id"
                                                   value="{{ item.id }}">
                                            {% if action_permission == "approve" %}
                                                {% ifequal item.active_Status "Active" %}
                                                    <tr>
                                                        {% if role == "accountant" or role == "CM" %}
                                                            <td><textarea type="text" class="form-control"
                                                                          name="item_name"
                                                                          required>{{ item.name }}</textarea></td>
                                                        {% else %}
                                                            <td><textarea type="text" class="form-control"
                                                                          name="item_name"
                                                                          readonly>{{ item.name }}</textarea></td>
                                                        {% endif %}
                                                        {% if role == "accountant" or role == "CM" %}
                                                            <td><textarea type="text" class="form-control"
                                                                          name="item_description"
                                                                          required>{{ item.description }}</textarea>
                                                            </td>
                                                        {% else %}
                                                            <td>
                                                                    <textarea type="text" class="form-control"
                                                                              name="item_description"
                                                                              readonly>{{ item.description }}</textarea>
                                                            </td>
                                                        {% endif %}
                                                        <td><input type="text" class="form-control"
                                                                   name="item_amount"
                                                                   value="{{ item.amount }}" readonly></td>
                                                        <td><input type="text" class="form-control"
                                                                   name="selected_cc_expense_item"
                                                                   value="{{ item.cost_Center }}" readonly></td>
                                                        <td><input type="text" class="form-control"
                                                                   name="selected_cc_expense_item"
                                                                   value="{{ item.active_Status }}" readonly></td>
                                                        {% if role == "accountant" %}
                                                            <td>
                                                                {#<!--href="../itemasset/{{ item.id }}"-->#}
                                                                <!--target="_blank"-->
                                                                <a type="button" onclick="getAsset({{ item.id }})"
                                                                   class="btn btn-primary btn-group"
                                                                   data-placement="top"
                                                                   title="Edit Asset" style="color: white"
                                                                   data-toggle="modal" data-target=""><i
                                                                        class="icon-pencil "> EDIT</i></a>
                                                            </td>
                                                        {% endif %}

                                                        {% if partial %}



                                                            <td>
                                                                <input type="checkbox" class="form-control"
                                                                       name="item"
                                                                       value="{{ item.id }}">
                                                            </td>
                                                            </tr>

                                                        {% endif %}
                                                {% endifequal %}
                                            {% else %}
                                                <tr>

                                                    <td><input type="text" class="form-control"
                                                               name="item_name"
                                                               value="{{ item.name }}" readonly></td>

                                                    <td><input class="form-control" name="item_description"
                                                               value="{{ item.description }}" readonly></td>

                                                    <td><input type="number" class="form-control"
                                                               name="item_amount"
                                                               value="{{ item.amount }}" readonly></td>

                                                    <td><input type="text" class="form-control"
                                                               name="selected_cc_expense_item"
                                                               value="{{ item.cost_Center.costCenterName }}"
                                                               readonly></td>



                                                    <td><input type="text" class="form-control"
                                                               name="item_active_Status"
                                                               value="{{ item.active_Status }}" readonly>
                                                    </td>

                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                        </tbody>


                                    </table>


                                </div>
                            </div>


                        </section>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">Attachments
                            </header>
                            <div class="card-body bg-white">


                                <div class="table-responsive">

                                    <table class="table table-striped">
                                        <!--Table head-->
                                        <thead>
                                        <tr>
                                            <th>Attachment</th>
                                            <th>Description</th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <!--Table head-->

                                        {% if role == "accountant" or role == "CM" %}
                                            <div class="well clearfix">
                                                <button type="button"
                                                        class="btn btn-primary btn-group pull-right"
                                                        name="add" value="Add Attachment"
                                                        id="addnew_attchment" onclick="add_new_attachment()"> Add New Attachment
                                                </button>

                                            </div>

                                        {% endif %}

                                        <!--Table body-->
                                        <tbody id="expense_attachment">

                                        {% for att in expense.attachments.all %}

                                            <tr>
                                                <td><a href="{{ MEDIA_URL }}{{ att.attachments.url }}"
                                                       target="_blank">{{ att.filename }}</a></td>

                                                <td><textarea class="form-control"
                                                              name="attachment_description_display"
                                                              readonly>{{ att.description }}</textarea></td>
                                                <td></td>

                                            </tr>
                                        {% endfor %}

                                        </tbody>


                                    </table>

                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Approver List
                            </header>
                            <div class="card-body bg-white">
                                <label>Current status:</label>
                                <div>
                                    {% for applist in expense.approverlist_set.all %}
                                        <h4> {{ applist.status }} by {% for app in applist.approverstatus_set.all %}
                                            {% if app.stage == applist.currentStage and app.status == "Pending" %}
                                                {{ app.approver }}{% endif %}
                                        {% endfor %}
                                        </h4>
                                    {% endfor %}
                                </div>
                                <div class="table-responsive">
                                    {% for applist in expense.approverlist_set.all %}
                                        <table class="table table-striped">
                                            <!--Table head-->
                                            <thead>
                                            <tr>
                                                <th>Department</th>
                                                <th>Approver</th>

                                                <th>Action</th>
                                                <th>Date</th>
                                                <th>Memo</th>
                                            </tr>
                                            </thead>
                                            {% for app in applist.approverstatus_set.all %}
                                                <tbody>
                                                <tr>

                                                    <td> {{ app.department }}</td>

                                                    <td>{{ app.approver }}</td>

                                                    <td> {{ app.status }}</td>

                                                    <td>{% if app.date %} {{ app.date }}{% endif %}</td>

                                                    <td> {% if app.memo %} {{ app.memo }}{% endif %}</td>

                                                </tr>
                                                </tbody>
                                            {% endfor %}

                                        </table>
                                    {% endfor %}
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>


            {% if action_permission == "approve" %}
                <div class="mb-3">
                    <div class="row">
                        <div class="col-lg-12">
                            <section class="card">
                                <header class="card-header bg-foxconn">
                                    Approver's Action
                                </header>
                                <div class="card-body bg-white">


                                    <div class="form-group col-md-12">
                                        <label for="memo">memo:</label>
                                        <textarea class="form-control" id="memo" name="memo"></textarea>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <button id="abutton" class="btn btn-success" type="button" data-toggle="modal"
                                                data-target="#approveModal">Approve
                                        </button>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <button id="rbutton" class="btn btn-danger" type="button" data-toggle="modal"
                                                data-target="#rejectModal">Reject
                                        </button>
                                    </div>

                                    {% if expense.approverlist_set.all.0.currentStage != 0 %}
                                        <div class="form-group col-md-3">
                                            <button id="aabutton" class="tiny button btn btn-primary pull-right"
                                                    type="button" data-toggle="modal" data-target="#addApproverModal">
                                                Add Approver
                                            </button>
                                        </div>
                                        {% if role != "accountant" %}
                                            <div class="form-group col-md-3">
                                                <button id="rebutton" class="tiny button btn btn-primary pull-right"
                                                        type="button" data-toggle="modal"data-target="#replaceMeModal">Replace Me
                                                </button>
                                            </div>
                                        {% endif %}

                                    {% endif %}

                                    <div class="form-group col-md-3 ">

                                        {% if role == "accountant" or role == "CM" %}
                                            <button id="updatebutton"
                                                    class="tiny button btn btn-outline-primary pull-right"
                                                    name="update_button"
                                                    type="submit">Update
                                            </button>
                                        {% endif %}
                                    </div>


                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            {% endif %}





            {#Modal Approve section#}
            <div class="modal fade" id="approveModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                 aria-hidden="true" data-backdrop="false" style="background-color: rgba(0, 0, 0, 0.5);">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Please Confirm!!!</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            {% if partial %}
                                <p>Are you sure you want to approve them?<br>Note: Selected Items Will Be
                                    Rejected!!!)</p>{% else %}
                                <p>Are you sure you want to approve them all?</p>{% endif %}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">No, Cancel</button>
                            <button type="submit" value="Approve" name="approve_button" class="btn btn-success">Yes,
                                Submit
                            </button>
                        </div>
                    </div>
                </div>
            </div>


            {#Reject Modal#}

            <div class="modal fade" id="rejectModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                 aria-hidden="true" data-backdrop="false" style="background-color: rgba(0, 0, 0, 0.5);">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Please Confirm</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to reject all items?</p>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal" value="RejectAll"
                                    name="reject_button">No, Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">Yes, Reject</button>
                        </div>
                    </div>
                </div>
            </div>


            {#Add Approver Modal#}

            <div class="modal fade" id="addApproverModal" tabindex="-1" role="dialog"
                 aria-labelledby="exampleModalLabel"
                 aria-hidden="true" data-backdrop="false" style="background-color: rgba(0, 0, 0, 0.5);">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Add Approver</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-row">

                                <div class="form-group col-md-12">
                                    <select class="selectpicker" name="approver" data-live-search="true" id="approver"
                                            onchange="Check()">
                                        <option disabled selected value> -- select an option --</option>
                                        {% for employee in employees %}
                                            <option value="{{ employee.associateID.associateID }}">{{ employee }}</option>{% endfor %}
                                    </select>
                                </div>
                                <div id="message"></div>

                                <div class="form-group col-md-12 form-check">
                                    <label class="form-check-label">Select Approver Position<br>
                                        <input type="radio" name="position" id="before" value="before"
                                               onclick="Check()"> Before Me
                                    </label>



                                    {% if role != "accountant" %}
                                        <label class="form-check-label" for="after">
                                            <input type="radio" name="position" id="after" value="after"
                                                   onclick="Check()">- After me</label>

                                    {% endif %}
                                </div>

                            </div>


                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal"
                                    name="reject_button">No, Cancel
                            </button>
                            <button type="submit" value="AddApprover" name="add_approver_button"
                                    class="btn btn-primary" disabled="True">Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>


            {#Replace Approver Modal#}
            <div class="modal fade" id="replaceMeModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                 aria-hidden="true" data-backdrop="false" style="background-color: rgba(0, 0, 0, 0.5);">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Replace Approver</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-row">

                                <div class="form-group col-md-12">
                                    <select class="selectpicker" name="reapprover" data-live-search="true"
                                            id="reapprover"
                                            onchange="CheckReplace()">
                                        <option disabled selected value> -- select an option --</option>
                                        {% for employee in employees %}
                                            <option value="{{ employee.associateID.associateID }}">{{ employee }}</option>{% endfor %}
                                    </select>
                                </div>
                                <div id="remessage"></div>
                                <!--                                <div class="form-group col-md-12">-->
                                <!--                                    <label><b>Select the position:</b></label><br>-->
                                <!--                                    <input type="radio" name="position" id="before" value="before" onclick="Check()">-->
                                <!--                                    <label for="before"><b>Before Me</b></label><br>-->
                                <!--                                    {% if role != "accountant" %}-->
                                    <!--                                        <input type="radio" name="position" id="after" value="after" onclick="Check()">-->
                                    <!--                                        <label for="after"><b>After Me</b></label><br>-->
                                    <!--                                    {% endif %}-->
                                <!--                                </div>-->
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal"
                                    name="reject_button">No, Cancel
                            </button>
                            <button type="submit" value="ReplaceApprover" name="replace_approver_button"
                                    class="btn btn-primary" disabled="True">Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>


            {#Edit Modal#}
            <div class="modal fade" id="editItemModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                 aria-hidden="true" data-backdrop="false" style="background-color: rgba(0, 0, 0, 0.5);">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel" style="padding-left: 35%">Choose Type</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-row">
                                <div class="form-group col-md-4"></div>
                                <div class="form-group col-md-4">

                                    <input type="radio"
                                           name="item_type" value="asset" data-toggle="modal"
                                           data-target="#Asset_Modal" data-dismiss="modal">&ensp;
                                    <label for="item_type"> Asset</label>
                                </div>


                                <div class="form-group col-md-4"></div>
                                <div class="form-group col-md-4"></div>

                                <div class="form-group col-md-4">
                                    <label for="item_type">
                                        <input type="radio" name="item_type" value=""
                                               data-toggle="modal"
                                               data-target="#Edit_UseTax" data-dismiss="modal"> &ensp;Expense
                                    </label>
                                </div>

                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal"
                                    name="reject_button">Close
                            </button>

                        </div>
                    </div>
                </div>
            </div>

            {#To Edit Asset Modal#}
            <div class="modal fade" id="Asset_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                 aria-hidden="true" data-backdrop="false" style="background-color: rgba(0, 0, 0, 0.5);">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Asset</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="asset_item_id" id="asset_item_id" value="">
                            <input type="hidden" name="asset_item_amount" id="asset_item_amount" value="">
                            <div class="form-row">
                                <!--                                <div class="form-group col-md-6">-->
                                <!--                                    <label for="asset_quantity">Quantity</label>-->
                                <!--                                    <input type="number" class="form-control" id="asset_quantity"-->
                                <!--                                           name="payment_date" step="1"-->
                                <!--                                           max="9999999999999" min="1" value="1" onchange="change_amount()">-->
                                <!--                                </div>-->

                                <!--                                <div class="form-group col-md-6">-->
                                <!--                                    <label for="asset_amount">Amount</label>-->
                                <!--                                    <input type="number" class="form-control" id="asset_amount"-->
                                <!--                                           name="asset_amount"-->
                                <!--                                           max="9999999999999.99" min="0.01" value="0.01" readonly>-->
                                <!--                                </div>-->

                                <!--                                 <div class="form-group col-md-6">-->
                                <!--                                    <label>GL account:</label>-->
                                <!--                                    <select class="selectpicker" data-live-search="true" name="asset_GL_account"-->
                                <!--                                            id="asset_GL_account">-->
                                <!--                                        <option selected value> &#45;&#45; Select An Option &#45;&#45;</option>-->
                                <!--                                        {% for gl in GL_accounts %}-->
                                    <!--                                            <option value="{{ gl.glCode }}">{{ gl.glDescription }}</option>-->
                                    <!--                                        {% endfor %}-->
                                <!--                                    </select>-->
                                <!--                                </div>-->
                                <div class="form-group col-md-6">
                                    <label for="asset_number">Asset Number:</label>
                                    <input type="text" class="form-control" id="asset_number"
                                           name="asset_number" >
                                </div>

                                <div class="form-group col-md-6">
                                    <label for="asset_subnumber">Sub-number:</label>
                                    <input type="text" class="form-control" id="asset_subnumber"
                                           name="asset_subnumber" maxlength="4">
                                </div>


                            </div>


                            <div class="modal-footer">
                                <button type="button" value="back" class="btn btn-secondary"
                                        name="back_button"data-toggle="modal"data-target="#editItemModal" data-dismiss="modal" >Back
                                </button>

                                <button type="button" value="Approve" name="save_asset_button"
                                        onclick="save_asset(event)"
                                        class="btn btn-primary" >Save
                                </button>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {#To Display Asset#}
            <div class="modal fade" id="Asset_Display" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                 aria-hidden="true" data-backdrop="false" style="background-color: rgba(0, 0, 0, 0.5);">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Asset</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="item_asset_id_display" id="item_asset_id" value="">
                            <div class="form-row">
                                <!--                                    <div class="form-group col-md-6">-->
                                <!--                                        <label for="asset_quantity_display">Quantity</label>-->
                                <!--                                        <input name="asset_quantity_display" class="form-control" id="asset_quantity_display" type="number"-->
                                <!--                                               readonly>-->
                                <!--                                    </div>-->
                                <!--                                    <div class="form-group col-md-6">-->
                                <!--                                        <label for="asset_amount_display">Amount</label>-->
                                <!--                                        <input name="asset_amount_display" class="form-control" id="asset_amount_display" type="number"-->
                                <!--                                               readonly>-->
                                <!--                                    </div>-->
                                <!--                                     <div class="form-group col-md-6">-->
                                <!--                                    <label>GL account:</label>-->
                                <!--                                    <input name="asset_gl" class="form-control" type="text" id="asset_gl" readonly>-->
                                <!--                                </div>-->

                                <div class="form-group col-md-6">
                                    <label for="asset_number_display">Asset Number:</label>
                                    <input id="asset_number_display" class="form-control" name="asset_number" type="text"
                                           readonly><br/>
                                </div>

                                <div class="form-group col-md-6">
                                    <label for="asset_subnumber_display">Asset Number:</label>
                                    <input id="asset_subnumber_display" class="form-control" name="asset_subnumber" type="text"
                                           readonly><br/>
                                </div>
                            </div>
                            <div class="modal-footer">


                                <button type="button" value="save" name="delete_item_button"
                                        onclick="delete_asset(event)"
                                        class="btn btn-danger">Delete
                                </button>
                                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close
                                </button>
                            </div>

                        </div>
                    </div>
                </div>
            </div>


            {#            Use useTax Modal For Edit Expense#}
            <div class="modal fade" id="Edit_UseTax" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                 aria-hidden="true" data-backdrop="false" style="background-color: rgba(0, 0, 0, 0.5);">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Expense</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="usetax_item_id" id="usetax_item_id" value="">

                            <div class="form-group col-md-12">
                                <label for="expense_assignment">Assignment:</label>
                                <textarea class="form-control" name="expense_assignment" type="text"
                                          id="expense_assignment"></textarea>
                            </div>

                            <div class="form-group col-md-6">
                                <label>GL account:</label>
                                <select class="selectpicker" data-live-search="true" name="selected_GL_account"
                                        id="selected_GL_account">
                                    <option selected value> -- Select An Option --</option>
                                    {% for gl in GL_accounts %}
                                        <option value="{{ gl.glCode }}">{{ gl.glDescription }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="expense_text">Text:</label>
                                <input class="form-control" name="item_text" type="text" id="expense_text">
                            </div>


                        </div>
                        <div class="modal-footer">
                            <button type="button" value="back" class="btn btn-secondary"
                                    name="back_button"data-toggle="modal"data-target="#editItemModal" data-dismiss="modal" >Back
                            </button>

                            <button type="button" value="save" name="save_expense_button"
                                    onclick="save_expense(event)"
                                    class="btn btn-primary" >Save
                            </button>
                        </div>
                    </div>
                </div>
            </div>


            {#        Expense Display#}

            <div class="modal fade" id="UseTax_Display" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                 aria-hidden="true" data-backdrop="false" style="background-color: rgba(0, 0, 0, 0.5);">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Expense</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="usetax_item_id_display" id="item_usetax_id" value="">
                            <div class="form-group col-md-6">
                                <label>GL account:</label>
                                <input name="usetax_gl" class="form-control" type="text" id="usetax_gl" readonly>
                            </div>

                            <div class="form-group col-md-6">
                                <label for="usetax_text">Text:</label>
                                <input name="usetax_text" class="form-control" type="text" id="usetax_text" readonly>
                            </div>

                            <div class="form-group col-md-12">
                                <label for="usetax_assignment">Assignment:</label>

                                <input name="usetax_assignment" class="form-control" type="text" id="usetax_assignment" readonly><br/>
                            </div>

                            <div class="modal-footer">
                                <button type="button" value="save" name="save_expense_button"
                                        onclick="delete_usetax(event)"
                                        class="btn btn-danger">Delete
                                </button>
                                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </fieldset>
    </form>

</section>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.5/js/bootstrap-select.min.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/12.1.2/js/intlTelInput.js'></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="{% static 'create_expense/js/scripts.js' %}"></script>
<script src="{% static 'create_expense/js/gritter.js' %}" type="text/javascript"></script>
<script src="{% static 'create_expense/script.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.26.0/moment-with-locales.min.js"></script>
{% if True %}
    <script>
        const url = '{% url 'chat_api' %}';
        const form_id = '{{ form_id }}';
        const user_id = '{{ request.session.user_id }}';
        const form_type = 'EA';
        const csrf_token = '{{ csrf_token }}';
        const chat_approver_url = '{%  url 'get_form_approver_api' %}'
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.11.0/underscore-min.js" type='text/javascript'></script>
    <script src="http://podio.github.io/jquery-mentions-input/lib/jquery.elastic.js" type='text/javascript'></script>
    <script src='http://podio.github.io/jquery-mentions-input/jquery.mentionsInput.js' type='text/javascript'></script>
    <script src="{% static 'office_app/js/chat.js' %}"></script>
{% endif %}
<script>

    $.fn.selectpicker.Constructor.BootstrapVersion = '4';


    <!--    function closepop(event) {-->
    <!--        event.target.parentNode.parentNode.style.display = "none";-->

    <!--    }-->

    <!--    document.getElementById("abutton").addEventListener('click', function () {-->
    <!--        document.getElementById("Check").style = "display:block"-->
    <!--    })-->
    <!--    document.getElementById("rbutton").addEventListener('click', function () {-->
    <!--        document.getElementById("RejectAll").style = "display:block"-->
    <!--    })-->
    <!--    document.getElementById("aabutton").addEventListener('click', function () {-->
    <!--        document.getElementById("select_approver").style = "display:block"-->
    <!--    })-->
    <!--    {% if role != "accountant" %}-->
        <!--    document.getElementById("rebutton").addEventListener('click', function () {-->

        <!--        $('#replaceMeModal').modal('show')-->
        <!--    })-->
        <!--    {% endif %}-->

    <!--   function change_amount(){-->
    <!--   var assamount=$('#asset_item_amount').val()/$('#asset_quantity').val()-->
    <!--   if(assamount<0.01){-->
    <!--        Swal.fire({-->
    <!--                        icon: 'error',-->
    <!--                        text: 'The quantity exceeds the maximum, the amount can not be less than 0.01!',-->
    <!--                    });-->
    <!--                    $('#asset_quantity').val(1);-->
    <!--                    $('#asset_amount').val(0.01);-->
    <!--   }else $('#asset_amount').val(assamount.toFixed(2));-->

    <!--   }-->


    var maximum=10;
    var current= {{ expense.attachments.all | length }};
    function add_new_attachment(){
        if(current<maximum){
            current++;
            attachmentinputstring='<tr><td> <input type="file" class="form-control" id="attachment" name="attachment" required></td><td><textarea class="form-control" id="attachment_description" name="attachment_description" placeholder="File Description" required></textarea></td><td><button type="button"  href="#" data-toggle="tooltip" data-placement="top" title="Delete" class="btn btn-danger btn-group delete input-group"><i class="icon_trash"></i></button></td></tr>'
            $('#expense_attachment').append(attachmentinputstring);}
        else
        {
            alert('You reach the limits')
        }

    }

    $('#expense_attachment').on("click", ".delete", function (e) {
        e.preventDefault();
        $(this).closest('tr').remove();
        current--;
    })


</script>
<script>
    {% for message in messages %}
        Swal.fire({
            icon: '{{ message.tags }}',
            text: '{{ message }}',
        })
    {% endfor %}

</script>


<script>

    function getAsset(itemId) {
        $.getJSON('../get_item/' + itemId,
            function (data) {
                console.log(data[0].fields['type'])
                if (data == null) {
                    Swal.fire({
                        icon: 'error',
                        text: 'The item is missing!',
                    });
                } else if (data[0].fields['type']== "null") {

                    $('#editItemModal').modal('show');
                    $('#usetax_item_id').val(itemId)
                    $('#asset_item_id').val(itemId)
                    $('#asset_item_amount').val(data[0].fields['amount'])

                } else {
                    <!--                    if (data[0].model == "expense.usetax") {-->
                    if(data[0].fields['type']=='use_tax'){
                        $('#UseTax_Display').modal('show');
                        $('#item_usetax_id').val(itemId);
                        $('#usetax_assignment').val(data[0].fields['assignment'])
                        $('#usetax_text').val(data[0].fields['text'])
                        $.get('../glbycode/', {"glcode": data[0].fields['GL']},
                            function (result) {
                                $('#usetax_gl').val(result);
                            });
                    } else {
                        $('#Asset_Display').modal('show')
                        $('#item_asset_id').val(itemId);
                        <!--                        $('#asset_quantity_display').val(data[0].fields['asset_quantity'])-->
                        <!--                        $('#asset_amount_display').val(data[0].fields['asset_amount'])-->
                        $('#asset_number_display').val(data[0].fields['asset_number'])
                        $('#asset_subnumber_display').val(data[0].fields['asset_subnumber'])
                        <!--                        $.get('../glbycode/', {"glcode": data[0].fields['GL']},-->
                        <!--                            function (result) {-->
                        <!--                                $('#asset_gl').val(result);-->
                        <!--                            });-->
                    }

                }
            }
        );
    }

    function save_expense(event) {
        if (!$('#selected_GL_account').val()) {
            $("#selected_GL_account").focus();
            alert("Please select a GL account!")
            return false;
        }

        if (!$('#expense_text').val()) {
            $("#expense_text").focus();
            alert("text can't be empty!")
            return false;
        }
        if (!$("#expense_assignment").val()) {
            $("#expense_assignment").focus();
            alert("assignment can't be empty!")
            return false;
        }
        $.get('../usetax_create/', {
                "GL": $('#selected_GL_account').val(),
                "text": $('#expense_text').val(),
                "assignment": $("#expense_assignment").val(),
                "item_id": $('#usetax_item_id').val()
            },
            function (data) {
                if (data == "OK") {
                    Swal.fire({
                        icon: 'success',
                        text: 'The expense is successfully assigned!',
                    }).then( function(){
                        $('#Edit_UseTax').toggleClass('show');
                        $('#Edit_UseTax').modal('hide');
                    });

                } else {
                    Swal.fire({
                        icon: 'error',
                        text: 'Some error happened!',
                    });
                }
            }
        );
    }

    function delete_usetax(event) {
        $.get('../usetax_delete/', {"id": $('#item_usetax_id').val()}, function (data) {
            Swal.fire({
                icon: 'success',
                text: 'The expense is successfully deleted!',
            });
            $('#UseTax_Display').modal('hide');
        });

    }

    function save_asset(event) {
        <!--        change_amount()-->
        <!--        if (!$('#asset_quantity').val()) {-->
        <!--            $("#asset_quantity").focus();-->
        <!--            alert("quantity can't be empty!")-->
        <!--            return false;-->
        <!--        }-->

        <!--        if (!$('#asset_amount').val()) {-->
        <!--            $("#asset_amount").focus();-->
        <!--            alert("amount can't be empty!")-->
        <!--            return false;-->
        <!--        }-->
        if (!$("#asset_number").val()) {
            $("#asset_number").focus();
            alert("asset number can't be empty!")
            return false;
        }
        if (!$("#asset_subnumber").val()) {
            $("#asset_subnumber").focus();
            alert("sub number can't be empty!")
            return false;
        }
        $.get('../asset_create/', {
                <!--                "GL" : $('#asset_GL_account').val(),-->
                "anumber": $('#asset_number').val(),
                "subnumber":$('#asset_subnumber').val(),
                <!--                "amount": $('#asset_amount').val(),-->
                <!--                "qty": $("#asset_quantity").val(),-->
                "item_id": $('#asset_item_id').val()
            },
            function (data) {
                if (data == "OK") {
                    Swal.fire({
                        icon: 'success',
                        text: 'The asset is successfully assigned!',
                    }).then(function(){
                        $('#Asset_Modal').toggleClass('show');
                        $('#Asset_Modal').modal('hide');
                    });

                } else {
                    Swal.fire({
                        icon: 'error',
                        text: 'Some error happened!',
                    });
                }
            }
        );
    }

    function delete_asset(event) {
        $.get('../asset_delete/', {"id": $('#item_asset_id').val()}, function (data) {
            Swal.fire({
                icon: 'success',
                text: 'The asset is successfully deleted!',
            });
            $('#Asset_Display').modal('hide');
        });

    }


    function onChange() {
        $("#approver").change(function () {
            Check()
        });
    }

    function Check() {
        $.get('../checkapprover/', {"associateID": $('#approver').val(), "expenseID": $('#expense_ID').val()},
            function (data) {
                if (data == "True") {
                    $('#message').html("");
                    if ($("input[name='position']").is(':checked'))
                        $("button[name='add_approver_button']").prop("disabled", false);
                } else if (data == "Requester") {
                    $('#message').html("This employee is the requester!");
                    $("button[name='add_approver_button']").prop("disabled", true);
                } else if (data == "Duplicate") {
                    $('#message').html("This employee is already existed!");
                    $("button[name='add_approver_button']").prop("disabled", true);
                } else {
                    $("button[name='add_approver_button']").prop("disabled", true);
                }
            });
    }

    $(document).ready(onChange);




    function CheckReplace() {
        $.get('../checkapprover/', {"associateID": $('#reapprover').val(), "expenseID": $('#expense_ID').val()},
            function (data) {
                if (data == "True") {
                    $('#remessage').html("");
                    $("button[name='replace_approver_button']").prop("disabled", false);
                } else if (data == "Requester") {
                    $('#remessage').html("This employee is the requester!");
                    $("button[name='replace_approver_button']").prop("disabled", true);
                } else if (data == "Duplicate") {
                    $('#remessage').html("This employee is already existed!");
                    $("button[name='replace_approver_button']").prop("disabled", true);
                } else {
                    $("button[name='replace_approver_button']").prop("disabled", true);
                }
            });
    }

    {% if role == "accountant" %}
        $('#msform').submit(function (e) {
            e.preventDefault()
            var $form = $(this);
            var btn = $form.find("button[type='submit']:focus")


            <!--     e.returnValue = false;-->

            if (btn.attr('name') === "approve_button") {
                if (!$('input[name="doc_header"]').val()) {
                    Swal.fire({
                        icon: 'error',
                        text: 'The document header is missing!',
                    }).then(function () {
                        Swal.close();
                        document.getElementById("Check").style = "display:none";
                        $('input[name="doc_header"]').focus();
                    });
                    return false;
                }

                $.get('../checkInvoice/', {
                        "invoiceNo": $("#expense_invoice_ID").val(),
                        "companyName": $("#expense_company").val(),
                        "vendor": $("#vendor").val(),
                        "expense_ID": $("#expense_ID").val()
                    },
                    function (data) {

                        if (data == "OK") {
                            var count=0;
                            $('input[name="item_id"]').each(function () {
                                <!--                                                 $.getJSON('../get_item/' + $(this).val(),-->
                                <!--                                                    function (data) {-->
                                <!--                                                        if (data == null) {-->
                                <!--                                                            Swal.fire({-->
                                <!--                                                                icon: 'error',-->
                                <!--                                                                text: 'The item is missing!',-->
                                <!--                                                            });-->
                                <!--                                                           count =0;-->
                                <!--                                                            return false;-->
                                <!--                                                        } else if (data[0].fields['type']== "null") {-->
                                <!--                                                            Swal.fire({-->
                                <!--                                                                icon: 'error',-->
                                <!--                                                                text: 'The item should be defined as either asset or expense!',-->
                                <!--                                                            });-->
                                <!--                                                            count =0;-->
                                <!--                                                            return false;-->
                                <!--                                                        }else count++;-->
                                <!--                                                    });-->
                                $.ajax({
                                    url: '../get_item/' + $(this).val(),
                                    dataType: 'json',
                                    async: false,
                                    success: function(data) {
                                        if (data == null) {
                                            Swal.fire({
                                                icon: 'error',
                                                text: 'The item is missing!',
                                            });
                                            count =0;
                                            return false;
                                        } else if (data[0].fields['type']== "null") {
                                            Swal.fire({
                                                icon: 'error',
                                                text: 'The item should be defined as either asset or expense!',
                                            });
                                            count =0;
                                            return false;
                                        }else count++;
                                    }
                                });

                            });

                            if(count!=0){
                                $form.off('submit');
                                Swal.fire({
                                    icon: 'success',
                                    text: 'Your action is submitted!',
                                });
                                var input = $("<input>")
                                    .attr("type", "hidden")
                                    .attr("name", btn.attr('name')).val("");
                                $form.append($(input));
                                $form.submit();
                            }

                        } else {
                            Swal.fire({
                                icon: 'error',
                                text: data,
                            });
                        }
                    });


            } else if (btn.attr('name') === "update_button") {

                if (!$('input[name="doc_header"]').val()) {
                    Swal.fire({
                        icon: 'error',
                        text: 'The document header is missing!',
                    }).then(function () {
                        Swal.close();
                        $('input[name="doc_header"]').focus();
                    });
                    return false;
                }
                $.get('../checkInvoice/', {
                        "invoiceNo": $("#expense_invoice_ID").val(),
                        "companyName": $("#expense_company").val(),
                        "vendor": $("#vendor").val(),
                        "expense_ID": $("#expense_ID").val()
                    },
                    function (data) {

                        if (data == "OK") {
                            $form.off('submit');
                            Swal.fire({
                                icon: 'info',
                                text: 'Please wait while data is being processed!',
                            });
                            $form.off('submit');
                            var input = $("<input>")
                                .attr("type", "hidden")
                                .attr("name", btn.attr('name')).val("");
                            $form.append($(input));
                            $form.submit();
                        } else {
                            Swal.fire({
                                icon: 'error',
                                text: data,
                            });
                            return false;
                        }
                    });
            } else {
                $form.off('submit');
                var input = $("<input>")
                    .attr("type", "hidden")
                    .attr("name", btn.attr('name')).val("");
                $form.append($(input));
                $form.submit();
            }
        });
    {% else %}
        $('#msform').submit(function (e) {

            e.preventDefault();
            <!--     e.returnValue = false;-->
            var $form = $(this);
            var btn = $form.find("button[type='submit']:focus");
            $form.off('submit');
            Swal.fire({
                icon: 'success',
                text: 'Your action is successfully submitted!\nPlease wait for the next step after you click OK.',
            }).then( function (){
                $form.off('submit');
                var input = $("<input>")
                    .attr("type", "hidden")
                    .attr("name", btn.attr('name')).val("");
                $form.append($(input));
                $form.submit();
            });


        });
    {% endif %}
</script>


</body>

</html>
