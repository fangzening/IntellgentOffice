<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>Create New Purchase Requisition Form - Smart Office | Foxconn</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/12.1.2/css/intlTelInput.css'>
    <link rel='stylesheet' href='https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css'>
    {#    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.min.css'>#}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/emojionearea/3.4.2/emojionearea.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-mentions-input@1.6.0/jquery.mentionsInput.min.css">
    <link rel="stylesheet" href="{% static 'office_app/css/chat.css' %}">
    <!-- font icon -->
    <link href="{% static 'purchase/css/elegant-icons-style.css' %}" rel="stylesheet"/>
    <!-- Custom styles -->
    <link id="main" href="{% static 'purchase/css/style2.css' %}" rel="stylesheet">
    <link id="summary_style" href="{% static 'purchase/css/summary_style.css' %}" rel="stylesheet" disabled="disabled">
    <link href="{% static 'purchase/css/style-responsive.css' %}" rel="stylesheet"/>
    <link href="{% static 'purchase/css/upload_style.css' %}" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.5/css/bootstrap-select.min.css"
          rel="stylesheet">


</head>

<body class="pr_form" id="purchase">

{% if show_chat %}
    <div class="container chat-container">
        <div class="row">
            <div class="chat-block col-md-3">
                <div class="card card-primary text-secondary">
                    <div class="card-header p-2" id="accordion">
                        <i id="chat-badge" class="fas fa-comment pl-2"></i> Chat
                        <div class="btn-group float-right pr-2">
                            <a type="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                                <i id="toggle_icon" class="fas fa-arrow-up"></i>
                            </a>
                        </div>
                    </div>
                    <div class="card-collapse collapse" id="collapseOne">
                        <div class="card-header text-center text-info p-1">Chat for PR Form: {{ form_id }}</div>
                        <div id="chat-body" class="card-body card-body-chat">
                            <ul class="chat" id="chat_list"></ul>
                        </div>
                        <div class="card-footer p-2">
                            <div class="input-group" style="flex-wrap: nowrap">
                                <textarea id="chat-input" class="mention"
                                          placeholder="Type your message here..."></textarea>
                                <i class="btn fas fa-level-down-alt text-primary" id="chat-scroll"
                                   title="Auto scroll on new message"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}

<!-- Multi step form -->
<section class="multi_step_form">
    <form id="msform" name="msform" method="POST">
        {% csrf_token %}
        <!-- Tittle -->
        <div class="tittle">
            <h1>Create Purchase Requisition Form</h1>
        </div>
        <!--menu bar-->
        <nav class="navbar navbar-expand-lg navbar-light  bg-light rounded nav nav-tabs">
            <a class="ml-5 h7">Welcome, {{ request.session.full_name }}</a>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
                    aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a href="{% url 'purchase_dashboard' %}" class="nav-link">Home</a>
                    </li>
                    <li class="nav-item mr-sm-2">
                        <a id="print_form" href="#" style="cursor: pointer" class="nav-link">Print Form</a>
                        {#                        <a href="javascript:window.print()" id="print_form" class="nav-link">Print Form</a>#}
                    </li>
                    <li class="nav-item mr-sm-2">
                        <a class="nav-link link" id="summary" onclick="toggle(); javascript:toggle(this);"
                           style="cursor: pointer">Page Summary</a>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="PurchasedropdownMenuButton" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Menu
                        </a>
                        <div class="dropdown-menu" aria-labelledby="PurchasedropdownMenuButton">
                            <a class="dropdown-item" href="{% url 'submitted_purchase' %}">View My Purchase
                                Requests </a>
                            <a class="dropdown-item" href="{% url 'purchase_to_approve' %}">Approve Purchase Request</a>
                        </div>
                    </li>
                    <li class="nav-item mr-sm-2">
                        <a type="button" id="notify_users" class="btn btn-warning float-right">
                            <i class="fas fa-bell "> </i> (Notify Users)
                        </a>
                    </li>
                    <li class="nav-item mr-sm-2">
                        <a href="{% url 'logout' %}" class="nav-link text-danger">Log Out</a>
                    </li>

                </ul>
            </div>
        </nav>
        <!-- progressbar -->
        <ul id="progressbar" class="mt-3">
            <li class="active">PR Form</li>
            <li>Item Detail</li>
            {% if purchase_request_form.isCompleted %}
                <li>Approver List</li>
            {% endif %}
        </ul>
        <!-- fieldsets -->
        <fieldset>
            <div class="drop_half">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Requisition Info (PR Form)

                            </header>
                            <div class="card-body bg-white">
                                <div class="form-row">
                                    <div class="form-group col-md-4 float-left">
                                        <label for="requestor">Requestor:</label>
                                        <input type="text" class="form-control" id="requestor" name="requestor" readonly
                                               value="{{ requestor.full_name }}" placeholder="Requestor">
                                    </div>
                                    <div class="form-group col-md-4">
                                    </div>
                                    <div class="form-group col-md-4 float-right">
                                        <label for="pr_number">PR Number</label>
                                        <input type="text" class="form-control" id="pr_number" name="pr_number"
                                               placeholder="Will be Auto-Generated "
                                               readonly {% if purchase_request_form.prNumber != None %}
                                               value="{{ purchase_request_form.prNumber }}" {% endif %}>
                                    </div>
                                    <div class="form-group col-md-4 float-left">
                                        <label for="creation_date">Creation Date (will be auto-generated):</label>
                                        <input type="text" class="form-control" id="creation_date" name="creation_date"
                                               readonly {% if purchase_request_form.isComplete is None or not purchase_request_form.isComplete %}
                                               value="{{ today | date:'M d, Y' }}" {% else %}
                                               value="b{{ purchase_request_form.creationDate | date:'M d, Y' }}" {% endif %}>
                                    </div>
                                    <div class="form-group col-md-4">
                                    </div>
                                    <div class="form-group col-md-4 float-right">
                                        <label for="po_number">PO Number (will be auto-generated):</label>
                                        <textarea type="text" class="form-control" id="po_number" name="po_number" readonly>{{ poNumber }}</textarea>
                                    </div>
                                    <div class="form-group col-md-4 float-left">
                                        <label for="creation_date">Currency:</label>
                                        <input type="text" class="form-control" id="currency" name="currency"
                                               maxlength="10"
                                                {% if purchase_request_form.currency != None %}
                                               value="{{ purchase_request_form.currency }}" {% else %}
                                               value="USD" {% endif %}>
                                    </div>

                                </div>
                            </div>

                        </section>
                    </div>
                </div>
            </div>
            <hr class="print">
            <div class="drop_half">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Basic Information
                            </header>
                            <div class="card-body bg-white">
                                <div class="form-row">

                                    <div class="form-group col-md-3 summary_select">
                                        <label for="business_unit">Business Unit: </label>
                                        <select class="{% if purchase_request_form.isCompleted != True %}selectpicker{% endif %} form-control summary_select mb-3 take_arrow"
                                                id="business_unit"
                                                name="business_unit" data-live-search="true"
                                                {% if purchase_request_form.isCompleted == True and details_to_edit == None %}  hidden {% endif %}>
                                            <option class="form-control" value="" disabled selected>Select Business Unit
                                            </option>
                                            {% for unit in business_units %}
                                                <option class="form-control"
                                                        id="{{ unit.plantCode }}//{{ unit.businessGroup.name }}//{{ unit.businessGroup.legalEntity.entityName }}"
                                                        {% if basic_info.businessUnit != None %}
                                                            {% if basic_info.businessUnit == unit %}
                                                        selected
                                                            {% endif %}
                                                        {% else %}
                                                            {% if unit.buName == request.session.business_unit %}
                                                        selected
                                                            {% endif %}
                                                        {% endif %}
                                                        value="{{ unit.pk }}">{{ unit.buName }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="form-group col-md-3">

                                        <label for="company">Company:</label>
                                        <select name="company" id="company" class="form-control {% if purchase_request_form.isCompleted != True %}  print_select selectpicker {% endif %} summary_select mb-3 take_arrow"
                                                data-live-search="true">
                                            <option class="form-control" value="" disabled selected>Select Company</option>
                                            {#                                                 {% if basic_info.company != None %}#}
                                            {% for company in companies %}
                                                <option class="form-control" id="{{ company.entityName }}"
                                                        {% if basic_info.company == company %}selected {% endif %} value="{{ company.entityName }}">{{ company.entityName }}

                                                </option>

                                            {% endfor %}

                                        </select>
                                    </div>
                                    <div class="form-group col-md-3 ">
                                        <label for="business">Business Group:</label>
                                        <input type="text"
                                               class="form-control {% if purchase_request_form.isCompleted != True %}selectpicker{% endif %} mb-3"
                                               id="business" name="business" data-live-search="true"
                                                {% for group in business_groups %}
                                                    {% if basic_info.businessGroup != None %}
                                                        {% if basic_info.businessGroup == group %}
                                               value="{{ group.name }}"
                                                        {% endif %}
                                                    {% else %}
                                                        {% if group.name == request.session.business_group %}
                                               value="{{ group.name }}"
                                                        {% endif %}
                                                    {% endif %}
                                                {% endfor %} readonly>
                                    </div>


                                    <div class="form-group col-md-3">
                                        <label for="plant_code">Plant Code:</label>
                                        <select type="text" class="form-control {% if purchase_request_form.isCompleted != True %}  print_select selectpicker {% endif %} summary_select mb-3 take_arrow" id="plant_code" name="plant_code" data-live-search="true" >
                                            <option class="form-control"{% if basic_info.plantCode != None %} selected {% endif %} value="{{ basic_info.plantCode }}">{{ basic_info.plantCode }}</option>
                                            <option class="form-control" value="" disabled >Select Plant Code </option>
                                            <option class="form-control" value="FII1" >FII1 </option>
                                            <option class="form-control" value="FII8" >FII8 </option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="project">Project:</label>
                                        <input type="text" class="form-control" id="project" name="project"
                                               maxlength="100"
                                               placeholder="Project"
                                               {% if basic_info.project != None %}value="{{ basic_info.project }}"{% endif %}>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="purpose">Purpose:</label>
                                        <input type="text" class="form-control" id="purpose" name="purpose"
                                               maxlength="100"
                                               placeholder="Purpose"
                                               {% if basic_info.purpose != None %}value="{{ basic_info.purpose }}"{% endif %}>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>

            <hr class="print">
            <div class="drop_half">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Supplier Information
                            </header>
                            <div class="card-body bg-white">
                                <div class="form-row">
                                    <div class="form-group col-md-4 summary_select">
                                        <label for="vendor_name">Vendor Name:</label>
                                        <select class="{% if purchase_request_form.isCompleted != True %}selectpicker{% endif %} form-control"  id="vendor_name" {% if purchase_request_form.isCompleted == True and details_to_edit == None %} hidden {% endif %}
                                                name="vendor_name" onchange="update_vendor()" data-show-subtext="true" data-live-search="true">
                                            <option class="form-control" value="" disabled selected>Select Vendor Code
                                            </option>
                                            {% for vendor in vendors %}
                                                <option class="form-control"
                                                        {% if vendor.pk == supplier_info.vendor.pk %}selected{% endif %}
                                                        value="{{ vendor.pk }}"
                                                        id="{{ vendor.vendorCode }}/-/{{ vendor.supplierTelephone }}/-/{{ vendor.supplierAddress }}">{{ vendor.vendorName }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="vendor_code">Vendor Code:</label> <!-- Gets vendor code -->
                                        <input type="text" class="form-control" id="vendor_code" name="vendor_code"
                                               placeholder="Vendor Code" readonly
                                               {% if supplier_info.vendor != None %}value="{{ supplier_info.vendor.vendorCode }}" {% endif %}>
                                    </div>

                                    <div class="form-group col-md-4">
                                        <label for="contact">Contact:</label> <!-- gets phone number -->
                                        <input type="text" required class="form-control" id="contact"
                                               placeholder="Contact"
                                               name="contact" readonly
                                               {% if supplier_info.vendor != None %}value="{{ supplier_info.vendor.supplierTelephone }}" {% endif %}>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group col-md-7">
                                        <label for="address">Address:</label> <!-- gets physical address -->
                                        <input type="text" class="form-control" id="address" name="address"
                                               placeholder="Address" readonly
                                               {% if supplier_info.vendor != None %}value="{{ supplier_info.vendor.supplierAddress }}" {% endif %}>
                                    </div>
                                    <div class="form-group col-md-5">
                                        <label for="email">Email Address:</label>
                                        <!-- gets email address (not listed) -->
                                        <input class="form-control" id="email" name="email" maxlength="128"
                                               placeholder="Email Address"
                                               {% if supplier_info.email != None %}value="{{ supplier_info.email }}" {% endif %}>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
            <hr class="print">
            <div class="drop_half">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn ">
                                Shipping Information / Memo
                            </header>
                            <div class="card-body bg-white">
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <label for="shipping_name">Name:</label>
                                        <input type="text" class="form-control" id="shipping_name" name="shipping_name"
                                               maxlength="100"
                                               placeholder="Shipping Name"
                                               {% if shipping_info.name != None %}value="{{ shipping_info.name }}"{% endif %}
                                               value="{{ request.user.employee }}">
                                    </div>
                                    <div class="form-group col-md-8">
                                        <label for="shipping_address">Address:</label>
                                        <select class="form-control {% if purchase_request_form.isCompleted != True %}selectpicker{% endif %}"
                                                data-live-search="true" id="shipping_address" name="shipping_address">
                                            {% for building in building_list %}
                                                {% if shipping_info.address != None %}
                                                    <option {% if building.locAddress == shipping_info.address %}selected{% endif %}
                                                            value="{{ building.locAddress }}">{{ building }} - {{ building.locAddress }}</option>
                                                {% else %}
                                                    <option {% if building.locAddress == request.user.employee.buildingAddress %}selected{% endif %}
                                                            value="{{ building.locAddress }}">{{ building }} - {{ building.locAddress }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </div>

                                </div>


                            </div>
                        </section>
                    </div>
                </div>
            </div>
            <br>
{#            {% if purchase_request_form.isCompleted == False %}#}
{#                <button type="submit" id="printing" class="action-button save_button float-left"#}
{#                        onclick="return set_submit_button('Save')">Save#}
{#                </button>#}
{#            {% endif %}#}
            <button type="button" id="printing" class="next action-button float-right">Continue</button>
            <input hidden id="submit_button" name="submit_button" readonly>
        </fieldset>

        <fieldset>
            {#            <h3 class="print">Item Detail, Asset Detail and Upload Supporting Document</h3>#}

            <div class="row drop_half">
                <div class="col-lg-12">
                    <section class="card">
                        <header class="card-header bg-foxconn">
                            Item Detail
                        </header>

                        <div class="scrollme">

                            <!--Table-->
                            <table id="item_detail" class="table table-responsive"
                                   style="display: none;" cellpadding="0"
                                   cellspacing="0">

                                <!--Table head-->
                                <thead>

                                {% if purchase_request_form.isCompleted == False %}
                                    <div class=" clearfix">
                                        <button type="button" class="btn btn-primary btn-group float-right m-2 hide_btn"
                                                data-toggle="tooltip" data-placement="top" title="Add New Item"
                                                id="addnew_item">
                                            Add New Item
                                        </button>
                                        {#                                        {% if purchase_item_details == None %}#}
                                        {#                                            <input id="show_table" id="printing" type="button"#}
                                        {#                                                   class="btn btn-primary float-left m-2"#}
                                        {#                                                   value="Create Table for Item"/>#}
                                        {#                                        {% endif %}#}
                                    </div>
                                {% endif %}
                                <tr>
                                    {% if purchase_request_form.employee.associateID != request.session.user_id and pk != "new" and request.session.department == 'Supporting - Accounting' and rows_to_approve != None %}
                                        <th scope="col">Create Asset</th>
                                    {% endif %}
                                    {#                                    <th scope="col"#}
                                    {#                                        {% if purchase_request_form.employee.associateID != request.session.user_id and pk != "new" and request.session.department == 'Supporting - Accounting' %}{% else %}hidden{% endif %}>#}
                                    {#                                        Asset Number#}
                                    {#                                    </th>#}
                                    <th scope="col">Supplier PN</th>
                                    {#                                    <th scope="col">Expected Arrival Date</th>#}
                                    <th scope="col" >Item Description</th>
                                    <th scope="col" class="print">Department</th>
                                    <th scope="col" class="print">C.C Code</th>
                                    <th scope="col">Unit Price</th>
                                    <th scope="col">Quantity</th>
                                    <th scope="col">Item Amount</th>
                                    <th scope="col">U.O.M</th>
                                    {% if purchase_request_form.isCompleted %}
                                        <th scope="col" class="print">Material Group</th>
                                    {% endif %}
                                    <th scope="col"
                                        {% if purchase_request_form.employee.associateID != request.session.user_id and pk != "new" and request.session.department == 'Supporting - Accounting' %}{% else %}hidden{% endif %}>
                                        GL Account
                                    </th>
                                    <th scope="col"
                                        {% if purchase_request_form.employee.associateID != request.session.user_id and pk != "new" and request.session.department == 'Supporting - Accounting' %}{% else %}hidden{% endif %}>
                                        GL Description
                                    </th>
                                    {% if pk != "new" and request.session.department == 'Supporting - Accounting' and purchase_request_form.employee.associateID != request.session.user_id and details_to_edit == None or purchase_request_form.employee.associateID == request.session.user_id and purchase_request_form.isCompleted == False %}
                                        <th scope="col">Action</th>
                                    {% elif purchase_request_form.employee.associateID != request.session.user_id and rows_to_approve != None %}
                                        <th scope="col" {% if pk != "new" and request.session.department != 'Supporting - Accounting' %}{% else %}hidden{% endif %}>
                                            Select
                                        </th>
                                    {% endif %}
                                    {% if items_that_need_PO_generated != None %}
                                        <th scope="col">Ready for PO Document</th>
                                    {% endif %}
                                </tr>
                                </thead>
                                <!--Table head-->


                                <!--Table body-->

                                <tbody id="itemDisplay">
                                {% if purchase_item_details == None %}
                                    <tr>

                                        <td><input onkeyup="widthauto(this)" maxlength="25" id="supplier_pn_0" name="supplier_pn" placeholder = "Supplier 0 " type="text"  class="form-control"/></td>
                                        {#                                        <td><input onkeyup="widthauto(this)" id="arrival_date_0" name="arrival_date" type="date" class="form-control"></td>#}
                                        <td><input style="width: 25em;" onkeyup="widthauto(this)" maxlength="25" id="item_description_0" name="item_description" placeholder = "Description" type="text"  class="form-control"/></td>
                                        <td class="print"><select onkeyup="widthauto(this)" onchange="update_cost_center_code();" id="department_0" name="department" type="text" class="custom-select custom-select-md ">{% for dept in departments %}<option title='{{ dept.costCenterCode }}' value='{{ dept.costCenterName }}'>{{ dept.costCenterName }}</option>{% endfor %}</select></td>
                                        <td class="print"><input onkeyup="widthauto(this)" id="cost_center_0" name="cost_center" placeholder = "C.Center" type="text" readonly class="form-control"/></td>
                                        <td class=""><input onfocusout="calculate_item_amount(0);" onkeyup=" calculate_item_amount(0); " maxlength="12" id="unit_price_0" name="unit_price" step="0.01" max="9999999999999.99" min="0.00"
                                                                       placeholder="0.00"  type="number"  class="form-control numberinput two-decimals"/></td>
                                        <td><input onfocusout="calculate_item_amount(0)" onkeyup="widthauto(this); calculate_item_amount(0); " id="quantity_0" maxlength="12" name="quantity"  placeholder="Qty 0 " type="text" class="form-control numberinput"></td>
                                        <td><input onkeyup="widthauto(this)" maxlength="12" id="amount_0" name="amount" placeholder = "Amount " type="text" readonly class="form-control numberinput"/></td>
                                        <td>
                                            {##}
                                            {#                                        <div class="form-group col-md-3">#}
                                            {#                                        <label for="plant_code">Plant Code:</label>#}
                                            {#                                        <select type="text" class="form-control {% if purchase_request_form.isCompleted != True %}  print_select selectpicker {% endif %} summary_select mb-3 take_arrow" id="plant_code" name="plant_code" data-live-search="true" >#}
                                            {#                                            <option class="form-control"{% if basic_info.plantCode != None %} selected {% endif %} value="{{ basic_info.plantCode }}">{{ basic_info.plantCode }}</option>#}
                                            {#                                            <option class="form-control" value="" disabled >Select Plant Code </option>#}
                                            {#                                            <option class="form-control" value="FII1" >FII1 </option>#}
                                            {#                                            <option class="form-control" value="FII8" >FII8 </option>#}
                                            {#                                        </select>#}
                                            {#                                    </div>#}

                                            <select class="form-control mb-3 take_arrow"
                                                    id="unit_of_measurement_0"
                                                    name="unit_of_measurement" data-live-search="true">



                                                {% for measure in measurement_unit %}
                                                    <option class="form-control"
                                                            {#                                                            {% if measure.pk == material_info.measure.pk %} selected {% endif %}#}
                                                            value="{{ measure.uom}}"
                                                            id="{{ measure.uom }}//{{ measure.uomDesc }}">
                                                        {{ measure.uom }} - {{ measure.uomDesc }}
                                                    </option>
                                                {% endfor %}
                                            </select>

                                        </td>
                                        {% if purchase_request_form.isCompleted %}
                                            <td class="print">
                                                <select id="material_group_0" name="material_group" class =" selectpicker form-control mb-3 take_arrow"  data-show-subtext="true" data-live-search="true">
                                                    <option class="form-control selectpicker" value="" disabled selected>Select Mat. Grp
                                                    </option>
                                                    <option class="form-control" value="AFE1">AFE1 - "Non-BOM Material" </option>
                                                    <option class="form-control" value="AFE2">AFE2 - "Repair&Maintenance" </option>
                                                    <option class="form-control" value="AFE3">AFE3 - "Computer Hardware" </option>
                                                    <option class="form-control" value="AFE4">AFE4 - "Office Expense" </option>
                                                    <option class="form-control" value="AFE5">AFE5 - "General Service"</option>
                                                    <option class="form-control" value="AFE6">AFE6 - "Indirect Supplies"</option>
                                                    <option class="form-control" value="AFE7">AFE7 - "Mail&Tele. Exp"</option>
                                                    <option class="form-control" value="AFE8">AFE8 - "Production"</option>
                                                    <option class="form-control" value="AFE9">AFE9 - "Facility"</option>
                                                    <option class="form-control" value="AFE10">AFE10 - "Asset"</option>
                                                    <option class="form-control" value="AFE11">AFE11 - "Toolings"</option>
                                                    <option class="form-control" value="AFE12">AFE12 - "Computer Software"</option>

                                                </select>


                                                {#                                                <input onkeyup="widthauto(this)" maxlength="25" id="material_group_0" name="material_group" placeholder = "Material Group" type="text"  class="form-control"/>#}
                                            </td>
                                        {% endif %}
                                        <td hidden><select hidden onkeyup="widthauto(this)" onchange="update_gl_descriptions();" id="gl_account_0" name="gl_account" type="text" class="custom-select custom-select-md"><option></option></select></td>
                                        <td hidden><input hidden onkeyup="widthauto(this)" id="gl_description_0" name="gl_description" placeholder = "GL Description " type="text" readonly class="form-control"/>     <input hidden readonly name="template_item_id" value="' + therowIndex + '"></td>
                                        <td class="print"><button type="button" class="btn btn-danger btn-group hide_btn delete" id="printing"  data-toggle="tooltip" data-placement="top" title="Delete Row"> <i class="icon_trash"></i> </button></td>
                                    </tr>

                                {% endif %}


                                {% if purchase_item_details != None %}
                                    {% for item in purchase_item_details %}
                                        <tr id="purchase_item_row_{{ item.pk }}"
                                            {% if item.isDeclined %}style="background-color: lightcoral"{% endif %} {% if item not in items_user_can_see and current_employee != requestor %}hidden{% endif %}>

                                            {% if purchase_request_form.employee.associateID != request.session.user_id and pk != "new" and rows_to_approve != None %}
                                                <th scope="row"
                                                    {% if request.session.department != 'Supporting - Accounting' %}hidden{% endif %}>
                                                    <input id="approver_check_0{{ item.pk }}" name="approver_check"
                                                           {% if purchase_request_form.employee.associateID != request.session.user_id and item in rows_to_approve and item.isDeclined == False %}{% else %}hidden{% endif %}
                                                            {% if purchase_item_assets != None %}
                                                                {% for asset in purchase_item_assets %}
                                                                    {% if asset.itemDetail == item %}
                                                                        checked
                                                                    {% endif %}
                                                                {% endfor %}
                                                            {% endif %}
                                                           type="checkbox" class="form-control"
                                                           onchange="modalpop(this.checked, '0{{ item.pk }}')">
                                                </th>
                                            {% endif %}
                                            <td><input onkeyup="widthauto(this)" id="supplier_pn_0{{ item.pk }}"
                                                       maxlength="25" name="supplier_pn" value="{{ item.supplierPn }}"
                                                       placeholder="Supplier 0 " type="text"
                                                       class="form-control shrink">
                                            </td>
                                            {#                                            <td><input onkeyup="widthauto(this)" id="arrival_date_0{{ item.pk }}"#}
                                            {#                                                       name="arrival_date"#}
                                            {#                                                       value="{{ item.expectedArrivalDate | date:"Y-m-d" }}"#}
                                            {#                                                       type="date" class="form-control shrink">#}
                                            {#                                            </td>#}
                                            <td>
                                                <input onkeyup="widthauto(this)" id="item_description_0{{ item.pk }}"
                                                       maxlength="100" name="item_description"
                                                       value="{{ item.itemDesc }}" placeholder="Description"
                                                       type="text" class="form-control shrink">
                                            </td>
                                            <td class="print">
                                                {#                                                <select onchange="widthauto(this)" id="department_0{{ item.pk }}"#}
                                                <select onchange="update_cost_center_code()" id="department_0{{ item.pk }}"
                                                        name="department"  type="text"
                                                        class="custom-select custom-select-md mb-3"
                                                        {% if item.assets != None and request.session.department == 'Supporting - Accounting' and item.final_stage_number == item.currentStage %}hidden{% endif %}>
                                                    {% for dept in departments %}
                                                        <option value="{{ dept.costCenterName }}"
                                                                title="{{ dept.costCenterCode }}"
                                                                {% if dept == item.costCenterCode %}selected{% endif %}>{{ dept.costCenterName }}</option>
                                                    {% endfor %}
                                                </select>

                                            </td>
                                            <td class="print ">
                                                <input onkeyup="widthauto(this)" id="cost_center_0{{ item.pk }}"
                                                       name="cost_center" placeholder="C.Center 0 " type="text"
                                                       class="form-control print" readonly value="{{ item.costCenterCode.costCenterCode }}">

                                                {#                                                <select onchange="widthauto(this)" id="cost_center_0{{ item.pk }}"#}
                                                {#                                                        name="cost_center"  type="text"#}
                                                {#                                                        class="custom-select custom-select-md mb-3" >#}
                                                {#                                                 {% if item.assets != None and request.session.department == 'Supporting - Accounting' and item.final_stage_number == item.currentStage %}hidden{% endif %}>#}
                                                {#                                                    {% for dept in departments %}#}
                                                {#                                                        <option value="{{ dept.costCenterName }}"#}
                                                {#                                                                title="{{ dept.costCenterCode }}"#}
                                                {#                                                                {% if dept == item.costCenterCode %}selected{% endif %}>{{ dept.costCenterCode }}</option>#}
                                                {#                                                    {% endfor %}#}
                                                {#                                                </select>#}
                                            </td>
                                            <td>
                                                <input onfocusout="calculate_item_amount('0{{ item.pk }}')"
                                                       onkeyup="calculate_item_amount('0{{ item.pk }}'); widthauto(this)"
                                                       id="unit_price_0{{ item.pk }}" maxlength="12" name="unit_price"
                                                       value="{% if item.unitPrice != None %}{{ item.unitPrice }}{% endif %}"
                                                       placeholder="Unit Price 0 " type="text"
                                                       class="form-control numberinput shrink">
                                            </td>
                                            <td>
                                                <input onfocusout="calculate_item_amount('0{{ item.pk }}')"
                                                       onkeyup="calculate_item_amount('0{{ item.pk }}'); widthauto(this)"
                                                       id="quantity_0{{ item.pk }}" maxlength="12" name="quantity"
                                                       value="{% if item.quantity != None %}{{ item.quantity }}{% endif %}"
                                                       placeholder="Qty 0 " type="text"
                                                       class="form-control numberinput shrink">
                                            </td>
                                            <td>
                                                <input onkeyup="widthauto(this)" id="amount_0{{ item.pk }}"
                                                       maxlength="12" name="amount" value="{% if item.itemAmount != None %}{{ item.itemAmount }}{% endif %}"
                                                       readonly placeholder="Amount 0 " type="text"
                                                       class="form-control numberinput shrink">
                                            </td>
                                            {#                                            <td><input onkeyup="widthauto(this)" maxlength="25" id="unit_of_measurement_0{{ item.pk }}" name="unit_of_measurement" type="text" class="form-control" {% if item.unitOfMeasurement != None %}value="{{ item.unitOfMeasurement }}"{% endif %}/></td>#}
                                            <td>
                                                <select class="form-control {% if purchase_request_form.isCompleted != True %} selectpicker {% endif %}  mb-3 take_arrow"
                                                        id="unit_of_measurement_0{{ item.pk }}" data-live-search="true"
                                                        name="unit_of_measurement" data-live-search="true" >
                                                    {% for measure in measurement_unit %}
                                                        <option class="form-control"
                                                                {% if measure.uom == item.unitOfMeasurement %} selected {% endif %}
                                                                value="{{ measure.uom }}"

                                                                id="{{ measure.uom }}//{{ measure.uomDesc }}">
                                                            {{ measure.uom }} - {{ measure.uomDesc }}
                                                        </option>
                                                    {% endfor %}
                                                </select>
                                            </td>
{#                                            <td {% if purchase_request_form.employee.associateID == request.session.user_id %} hidden {% endif %}>#}
                                            {% if purchase_request_form.employee.associateID != request.session.user_id %}
                                            <td>
                                                <select id="material_group_0{{ item.pk }}" name="material_group" class ="form-control {% if purchase_request_form.isCompleted != True %}selectpicker{% endif %}  mb-3 take_arrow"  data-show-subtext="true" data-live-search="true">
                                                    <option class="form-control" value="{% if item.matGroup != None %}{{ item.matGroup }}{% endif %}" selected>{{ item.matGroup }} </option>
                                                    <option class="form-control" value="AFE1">AFE1 - "Non-BOM Material" </option>
                                                    <option class="form-control" value="AFE2">AFE2 - "Repair&Maintenance" </option>
                                                    <option class="form-control" value="AFE3">AFE3 - "Computer Hardware" </option>
                                                    <option class="form-control" value="AFE4">AFE4 - "Office Expense" </option>
                                                    <option class="form-control" value="AFE5">AFE5 - "General Service"</option>
                                                    <option class="form-control" value="AFE6">AFE6 - "Indirect Supplies"</option>
                                                    <option class="form-control" value="AFE7">AFE7 - "Mail&Tele. Exp"</option>
                                                    <option class="form-control" value="AFE8">AFE8 - "Production"</option>
                                                    <option class="form-control" value="AFE9">AFE9 - "Facility"</option>
                                                    <option class="form-control" value="AFE10">AFE10 - "Asset"</option>
                                                    <option class="form-control" value="AFE11">AFE11 - "Toolings"</option>
                                                    <option class="form-control" value="AFE12">AFE12 - "Computer Software"</option>

                                                </select>
                                                {#                                                <input onkeyup="widthauto(this)"#}
                                                {#                                                       title="Unless you are a buyer for a business unit, you do not need to worry about this field"#}
                                                {#                                                       id="material_group_0{{ item.pk }}" maxlength="25"#}
                                                {#                                                       name="material_group" value="{{ item.matGroup }}"#}
                                                {#                                                       placeholder="Material Group 0 " type="text"#}
                                                {#                                                       class="form-control print shrink">#}
                                            </td>
                                            {% endif %}
                                            <td {% if request.session.department != 'Supporting - Accounting' %}hidden{% endif %}>
                                                <select onchange="widthauto(this); update_gl_descriptions();"
                                                        id="gl_account_0{{ item.pk }}" name="gl_account"
                                                        class="form-control {% if purchase_request_form.isCompleted != True %}selectpicker{% endif %} mb-3 take_arrow"  data-show-subtext="true" data-live-search="true">
                                                    {#                                                        {% if item.assets != None and request.session.department == 'Supporting - Accounting' and item.final_stage_number == item.currentStage %}hidden>#}
                                                    {% for account in gl_accounts %}
                                                        <option  class="form-control" value="{{ account.glDescription }}"
                                                                 {% if account == item.glAccount %}selected{% endif %}>{{ account.glCode }}</option>
                                                    {% endfor %}
                                                    {#                                                        {% endif %}#}
                                                </select>
                                            </td>
                                            <td {% if request.session.department != 'Supporting - Accounting' %}hidden{% endif %}>

                                                <input onchange="widthauto(this)" id="gl_description_0{{ item.pk }}"
                                                       name="gl_description" value="{{ item.glAccount.glDescription }}"
                                                       placeholder="GL Description 0 " readonly type="text"
                                                       class="form-control"
                                                       {% if item.assets != None and request.session.department == 'Supporting - Accounting' and item.final_stage_number == item.currentStage %}hidden{% endif %}>
                                                <input class="form-control" hidden readonly name="template_item_id" value="0{{ item.pk }}">
                                            </td>
                                            {% if request.session.department != 'Supporting - Accounting' %}
                                                <td id="buttons_for_item_{{ item.pk }}">
                                                    {% if purchase_request_form.employee.associateID == request.session.user_id and purchase_request_form.isCompleted == False %}
                                                        <button type="button" class="btn btn-danger btn-group delete"
                                                                data-toggle="tooltip" data-placement="top" id="printing"
                                                                title="Delete Row">
                                                            <i class="icon_trash"></i>
                                                        </button>
                                                    {% else %}
                                                        {% if purchase_request_form.employee.associateID != request.session.user_id and item in rows_to_approve %}
                                                            <input type="checkbox" name="item_checkbox"
                                                                   id="item_checkbox_{{ item.pk }}"
                                                                   onchange="update_checkbox('{{ item.pk }}')"
                                                                   class="form-control" checked>
                                                            <input hidden name="item_checkbox_value"
                                                                   id="item_checkbox_value_{{ item.pk }}" value="on">
                                                        {% endif %}
                                                    {% endif %}
                                                    {% if item in items_that_need_PO_generated %}
                                                        <b style="color: lightseagreen">
                                                            Ready
                                                        </b>
                                                    {% endif %}
                                                </td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                {% endif %}

                                </tbody>
                                <!--Table body-->
                                <tfoot>
                                <tr>
                                    <th class="print">
                                        Form total:
                                    </th>
                                    <td colspan="2">
                                        <input readonly class="form-control" id="form_total" name="form_total"
                                               {% if purchase_request_form.prAmount != None %}value="{{ purchase_request_form.prAmount }}"
                                               {% else %}value="0.00"{% endif %}>
                                    </td>
                                </tr>
                                </tfoot>
                            </table>


                            {% if items_that_need_PO_doc_generated != None %}
                                <button type="submit" class="btn btn-success m-2" data-toggle="tooltip"
                                        data-placement="top" id="Generate PO Document"
                                        title="Generate PO Document"
                                        onclick="return set_submit_button('Generate PO Document')">
                                    Generate PO Document
                                </button>
                            {% endif %}
                        </div>
                    </section>
                </div>
            </div>

            <hr class="print">
            <div class="drop_half">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Memo
                            </header>
                            <div class="card-body bg-white">

                                <div class="form-row">
                                    <div class="form-group col-md-12">
                                        <label for="memo">Memo:</label>
                                        <textarea type="text" class="form-control " id="memo" name="memo"
                                                  placeholder="Please include expected arrival date in Memo">{%if shipping_info.memo != None%}{{shipping_info.memo}}{%endif%}</textarea>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>

            {#            {% if purchase_request_form.isCompleted %}#}
            {% if request.session.department == 'Supporting - Accounting' %}
                <hr class="print">

                <!--Created Asset Table-->
                <div class="print">
                    <div class="row">
                        <div class="col-lg-12">
                            <section class="card">
                                <header class="card-header bg-foxconn">
                                    Asset Created
                                </header>
                                <div class="card-body bg-white">
                                    <div class="table-responsive text-nowrap">
                                        <!--Table-->

                                        {% if purchase_item_assets == None %}
                                            <table id="displaymodal" class="table table-responsive table-hover">

                                            <!--Table head-->
                                            <thead>

                                            </thead>

                                            <!--Table head-->

                                            <!--Table body-->
                                        {% endif %}
                                        {% if purchase_item_assets != None %}
                                            <table id="displaymodal" class="table table-responsive table-hover" style="width: 100%;">
                                                <tbody id="displaymodalbody">
                                                <tr>
                                                    <input type="submit" name="generate_asset_button"
                                                           class="btn btn-success ml-auto" style="margin-bottom: 15px" id="generate_asset_button" value="Generate Asset Number" onclick="return set_submit_button('Generate Asset');"/>
                                                </tr>
                                                <tr id="displaymodalheader">
                                                    <th>Asset Number</th>
                                                    <th>Item Description</th>
                                                    <th>Asset Class</th>
                                                    <th>Tech Category 1</th>
                                                    <th>Tech Category 2</th>
                                                    <th>Tech Category 3</th>
                                                    <th>Tech Category 4</th>
                                                </tr>
                                                {% for asset in purchase_item_assets %}
                                                    <tr name="item_asset_0{{ asset.itemDetail.pk }}">
                                                        <td><input type="text" readonly
                                                                   {% if asset.itemDetail.assetNo != 0 %}value="{{ asset.itemDetail.assetNo }}"{% endif %}
                                                                   class="form-control" name="asset_numberdisplay"
                                                                   placeholder="Asset Number"
                                                                   id="asset_numberdisplay_0{{ asset.itemDetail.pk }}_1">
                                                        </td>
                                                        <td><input type="text" readonly
                                                                   value="{{ asset.itemDetail.itemDesc }}"
                                                                   class="form-control" name="item_descriptiondisplay"
                                                                   placeholder="Description"
                                                                   id="item_descriptiondisplay_0{{ asset.itemDetail.pk }}_1">
                                                        </td>
                                                        <td><input type="text" value="{{ asset.assetClass }}" maxlength="50"
                                                                   class="form-control" name="asset_class"
                                                                   placeholder="Asset Class"
                                                                   id="asset_class_0{{ asset.itemDetail.pk }}_1"></td>
                                                        <td><input type="text" value="{{ asset.techCat1 }}" maxlength="50"
                                                                   class="form-control" name="tech_category1"
                                                                   placeholder="Tech Category 1"
                                                                   id="tech_category1_0{{ asset.itemDetail.pk }}_1"></td>
                                                        <td><input type="text" value="{{ asset.techCat2 }}" maxlength="50"
                                                                   class="form-control" name="tech_category2"
                                                                   placeholder="Tech Category 2"
                                                                   id="tech_category2_0{{ asset.itemDetail.pk }}_1"></td>
                                                        <td><input type="text" value="{{ asset.techCat3 }}" maxlength="50"
                                                                   class="form-control" name="tech_category3"
                                                                   placeholder="Tech Category 3"
                                                                   id="tech_category3_0{{ asset.itemDetail.pk }}_1"></td>
                                                        <td><input type="text" value="{{ asset.techCat4 }}" maxlength="50"
                                                                   class="form-control" name="tech_category4"
                                                                   placeholder="Tech Category 4"
                                                                   id="tech_category4_0{{ asset.itemDetail.pk }}_1">
                                                            <input name="template_asset_id"
                                                                   value="0{{ asset.itemDetail.pk }}" readonly="" hidden="">
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        {% else %}
                                            <tbody id="displaymodalbody">
                                            </tbody>
                                        {% endif %}
                                        <!--Table body-->

                                        {% if purchase_item_assets == None %}
                                            </table>
                                        {% endif %}
                                    </div>
                                </div>
                            </section>

                        </div>

                    </div>
                </div>
            {% endif %}
            <input hidden id="form_pk" name="form_pk" value="{{ pk }}">
            <!-- End of Asset-->

            <!--Upload Document Function-->
            <hr class="print">
            <div class="print">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Upload Supporting Document
                            </header>
                            <div class="card-body bg-white">
                                <div class="uploaded_files" id="uploaded_files_list">
                                    {% if uploaded_files != None %}
                                        {% if purchase_request_form.isCompleted == False %}Already {% endif %}Uploaded
                                        Files:
                                        {% for file in uploaded_files %}
                                            <br><a href="{% get_media_prefix %}{{ file.location }}/{{ file.fileName }}"
                                                   target="_blank">{{ file.fileName }}</a>
                                        {% endfor %}
                                        <br><br>
                                        Upload more Files:
                                    {% endif %}
                                </div>

                                <input type="hidden" id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="300000"/>


                                <span class="input-group-btn file-msg">
                                     <span class="btn btn-primary" id="printing" onclick="$('#fileselect').click();">Upload Files</span>
                                     <input type="file" id="fileselect" name="fileselect[]" multiple="multiple" hidden />
                                </span>
                                {#                                The Drag and Drop Zone is still under construction to pass Data from users tpo the DB#}
                                {#                                <div id="filedrag">#}
                                {#                                <i class="fas fa-cloud"><em>or drop files here</em></i>#}
                                {#                            </div>#}


                                {##}
                                {#                                              <input name="uploaded_file" id="uploaded_file"#}
                                {#                                                     onchange="$(this).parent().parent().find('.form-control').html($(this).val().split(/[\\|/]/).pop()); document.getElementById('upload_files_button').removeAttribute('hidden');"#}
                                {#                                                     style="display: none;" type="file"  class="file-input" multiple >#}
                                {#                                            </span>#}
                                {#                                        <span class="form-control" id="uploaded_file_name"></span>#}
                                {##}
                                {#                            <div id="submitbutton">#}
                                {#                                <button class="btn btn-primary" type="submit">Upload Files</button>#}
                                {#                            </div>#}


                                <div id="messages" class="card-body">
                                    <p class="font-italic text-center">-----Uploaded Files-----</p>
                                </div>
                            </div>


                            {#                            <div class="card-body bg-white">#}

                            {#                                <div id="upload_more_files_div">#}
                            {#                                    {% if uploaded_files != None %}#}
                            {#                                        <br><br>Upload More Files:#}
                            {#                                    {% endif %}#}
                            {#                                    <div class="input-group file-drop-area">#}
                            {#                                            <span class="input-group-btn file-msg">#}
                            {#                                              <span class="btn btn-primary hide_btn" id="printing"#}
                            {#                                                    onclick="$(this).parent().find('input[type=file]').click();">Browse</span>#}
                            {#                                              <input name="uploaded_file" id="uploaded_file"#}
                            {#                                                     onchange="$(this).parent().parent().find('.form-control').html($(this).val().split(/[\\|/]/).pop()); document.getElementById('upload_files_button').removeAttribute('hidden');"#}
                            {#                                                     style="display: none;" type="file"  class="file-input" multiple >#}
                            {#                                            </span>#}
                            {#                                        <span class="form-control" id="uploaded_file_name"></span>#}
                            {#                                    </div>#}
                            {#                                    {% if purchase_request_form.isCompleted %}#}
                            {#                                        <!-- Button for people who do not have access to save or finish button so that they can upload files -->#}
                            {#                                        <button hidden type="submit" class="action-button" name="upload_files_button"#}
                            {#                                                id="upload_files_button"#}
                            {#                                                onclick="return set_submit_button('Upload Chosen File')">Upload Files#}
                            {#                                        </button>#}
                            {#                                    {% endif %}#}
                            {#                                </div>#}
                            {#                            </div>#}
                            {##}
                            {#                           #}




                            {##}
                            {#                            New File Upload field #}
                            {##}
                            {#                               <div class="file-drop-area">#}
                            {#  <span class="fake-btn">Choose files</span>#}
                            {#  <span class="file-msg ">or drag and drop files here</span>#}
                            {#  <input class="file-input" type="file" multiple>#}
                            {#</div>#}


                        </section>

                    </div>

                </div>
            </div>
            <hr/>
            {% if purchase_request_form.isCompleted and  purchase_request_form.employee.associateID != request.session.user_id  and not is_buyer %}

                <div class="drop_half">
                    <div class="row">
                        <div class="col-lg-12">
                            <section class="card">
                                <header class="card-header bg-foxconn">
                                    Approver's Comment
                                </header>
                                <div class="card-body bg-white">

                                    <div class="form-row">
                                        <div class="form-group col-md-12">
                                            <label for="approver_comment">Approver's Comment:</label>
                                            <textarea type="text" class="form-control " id="approver_comment" name="comment" placeholder="Please type your comment here..."></textarea>
                                        </div>
                                    </div>

                                </div>
                            </section>
                        </div>
                    </div>
                </div>

            {% endif %}




            {##}
            {#            <div id="signature" class="row">#}
            {#                <div class="col-lg-12">#}
            {#                    <section class="card">#}
            {#                        <header class="card-header">#}
            {#                            Signature#}
            {#                        </header>#}
            {#                        <div class="card-body bg-white">#}
            {#                            <div class="form-row">#}
            {#                                <div class="form-group col-md-4 pull-left">#}
            {#                                    <label for="requestor">Requestor's Name:</label>#}
            {#                                    <input type="text" class="form-control" id="requestor" name="requestor" readonly#}
            {#                                           value="{{ requestor.full_name }}" placeholder="Requestor">#}
            {#                                </div>#}
            {#                                <div class="form-group col-md-4">#}
            {#                                    <label for="requester_signature_date">Date</label><br>#}
            {##}
            {#                                    ________________________________________#}
            {#                                </div>#}
            {#                                <div class="form-group col-md-4 ">#}
            {#                                    <label for="requester_signature">Requestor's Signature</label>#}
            {#                                    ________________________________________#}
            {#                                </div>#}
            {##}
            {#                                <div class="form-group col-md-4 ">#}
            {#                                    <label for="approver_name">Approver Name</label>#}
            {#                                    ________________________________________#}
            {#                                </div>#}
            {#                                <div class="form-group col-md-4">#}
            {#                                    <label for="approver_signature_date">Date</label><br>#}
            {##}
            {#                                    ________________________________________#}
            {#                                </div>#}
            {#                                <div class="form-group col-md-4 ">#}
            {#                                    <label for="approver_signature">Approver Signature</label>#}
            {#                                    ________________________________________#}
            {#                                </div>#}
            {##}
            {##}
            {#                            </div>#}
            {#                        </div>#}
            {#                    </section>#}
            {#                </div>#}
            {#            </div>#}
            {#            </div>#}

            <!--Section: Live, preview-->
            <br>

            <button type="button" id="printing" class="action-button previous previous_button">Back</button>

            {#            <button type="button" id="printing" class="next action-button float-right">Continue</button>#}

            {% if purchase_request_form.isCompleted == False or details_to_edit != None and purchase_request_form.employee.associateID != request.session.user_id %}
                <button type="submit" id="printing" class="action-button save_button ml-3"
                        onclick="return set_submit_button('Save')">
                    Save
                </button>

            {% endif %}

            {% if purchase_request_form.isCompleted == False or details_to_edit != None %}
                <input type="submit" class="action-button send float-right" id="printing"
                       onclick="set_submit_button('Finish'); generatepr()"
                       value="Finish">
            {% else %}
                <button type="button" id="printing" class="next action-button float-right">Continue</button>
            {% endif %}
            {% if purchase_request_form.employee.associateID != request.session.user_id %}
                {% if request.session.department == "Supporting - Accounting" and rows_to_approve != None and pk != 'new' %}
                    <button type="submit" class="btn btn-success m-2 print" data-toggle="tooltip"
                            data-placement="top" id="Accounting Approve" title="Accounting Approve"
                            onclick="return set_submit_button('Accounting Approve')">
                        Save Changes and Approve Form
                    </button>
                    <button type="submit" class="btn btn-success m-2 print" data-toggle="tooltip"
                            data-placement="top" id="Accounting Save" title="Accounting Save"
                            onclick="return set_submit_button('Accounting Save')">
                        Save Changes
                    </button>
                {% else %}
                    {% if rows_to_approve != None and details_to_edit == None %}
                        <button type="submit" class="btn btn-success m-2" data-toggle="tooltip"
                                data-placement="top" id="Approve Selected Items"
                                title="Approve Selected Items"
                                onclick="return set_submit_button('Approve Selected Items')">
                            Approve Selected Items
                        </button>
                        <button type="submit" class="btn btn-danger m-2" data-toggle="tooltip"
                                data-placement="top" id="Decline Selected Items"
                                title="Decline Selected Items"
                                onclick="return set_submit_button('Decline Selected Items')">
                            Decline Selected Items
                        </button>
                    {% endif %}
                {% endif %}
            {% endif %}
        </fieldset>

        {% if purchase_request_form.isCompleted %}
            <fieldset id="printing">
                <h3>Approver List</h3>
                <h4 id="reload_message" style="color: darkred" hidden><b>Reload the page to see an updated version of
                    the list</b><br><br><br></h4>
                <div class="">
                    <div class="mb-2" style="font-size: 12px; color: #880000"><b>Bold Name of Approvers</b> Shows the current stage of the Item</div>
                    <section class="card">
                        <header class="card-header bg-foxconn">
                            Approver List
                        </header>
                        <div id="accordion">
                            <div class="card-body">
                                <table class="table  table-bordered table-hover">
                                    <thead>
                                    <tr>

                                        <th>Approver</th>
                                        {#                                    <th>Stage</th>#}
                                        <th>Date Assigned</th>
                                        <th>Action Taken</th>
                                        <th>Approver's Comment</th>
                                        <th>Date of Action</th>
                                    </tr>
                                    </thead>

                                    <tbody>
                                    {% for stage in forms_stages %}
                                        {% if stage.stage == 1 %}
                                            <tr class="btn btn-link" data-toggle="collapse"  data-target="#collapse{{ stage.formID.itemDesc }}" aria-expanded="true" aria-controls="collapseOne" id="process {{ stage.formID.itemDesc }}">
                                                <td style="cursor: pointer; font-size:12px; display: table-row " colspan="6">Click to View Full Approval Process for {{ stage.formID.itemDesc }}   </td>
                                            </tr>
                                        {% endif %}
                                        <tr id="collapse{{ stage.formID.itemDesc }}" class="collapse" aria-labelledby="headingOne" data-parent="#accordion" class="child-process {{ stage.formID.itemDesc }}" {% if stage.stage == stage.formID.currentStage and stage.formID in items_user_can_see %}
                                            style="font-weight: bold; font-size:12px; color: #880000; display: table-row "  {% endif %}>





                                            {#                                        <td>#}
                                            {#                                            {{ stage.formID.itemDesc }}#}
                                            {#                                        </td>#}
                                            <td style="font-size:12px;">
                                                {{ stage.approverID }}
                                            </td>
                                            {#                                        <td>#}
                                            {#                                            {{ stage.stage }}#}
                                            {#                                        </td>#}
                                            <td style="font-size:12px;">
                                                {% if stage.dayAssigned != None %}{{ stage.dayAssigned }}{% endif %}
                                            </td>
                                            <td style="font-size:12px;">
                                                {% if stage.actionTaken != None %}{{ stage.actionTaken }}{% else %} Pending {% endif %}
                                            </td>
                                            <td style="font-size:12px;">
                                                {% if stage.comments != None %}{{ stage.comments }}{% endif %}
                                            </td>
                                            <td style=" font-size:12px;">
                                                {% if stage.date != None %}{{ stage.date }}{% endif %}
                                            </td>
                                        </tr>
                                        </tbody>

                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>
                </div>
            <hr/>


            <div class="drop_half">
                    <div class="row">
                        <div class="col-lg-12">
                            <section class="card">
                                <header class="card-header bg-foxconn">
                                    Add Cosigner
                                </header>
                                <div class="card-body bg-white">
{#                                    <div class="form-row">#}
                                        <div class="form-group col-md-4 summary_select">
                                            <label for="cosigner_name">Approver's Name:</label>
                                           <select class="selectpicker form-control"  id="cosigner_name" name="cosigner_name"
                                                    data-show-subtext="true" data-live-search="true">
                                                <option class="form-control" value="" disabled selected>Select Cosigner</option>
                                                {% for cosigner in cosignees %}
                                                    {% if cosigner != request.user %}
                                                    <option class="form-control" value="{{ cosigner.associateID }}"
                                                            id="{{ cosigner.associateID }}">{{ cosigner.fullname }}</option>
                                                    {% endif %}
                                                {% endfor %}
                                            </select>
                                        </div>
{#                                    </div>#}

{#                                     <div class="form-row col-md-4">#}
                                            <button type="submit" class="btn btn-success m-2 float-right" data-toggle="tooltip"
                                                    data-placement="top" id="Add Cosigner"
                                                    title="Add Cosigner"
                                                    onclick="return set_submit_button('Add Cosigner')">Add Cosigner
                                            </button>
{#                                    </div>#}
                                    </div>


                            </section>
                        </div>
                    </div>
                </div>



                                    {#            onchange="update_cosigner()"#}



                    <br>
                    <button type="button" id="printing" class="action-button previous previous_button">Back</button>
                    <!-- for some reason confirmation question does not show. It is not neccessary, but would be nice to have -->
            </fieldset>
        {% endif %}

        <!-- End Multi step form -->
    </form>
</section>


<!-- JS Scripts -->

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.5/js/bootstrap-select.min.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/12.1.2/js/intlTelInput.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/promise-polyfill"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.3.0/jquery.form.min.js"
        integrity="sha384-qlmct0AOBiA2VPZkMY3+2WqkHtIQ9lSdAsAn5RUJD/3vA5MKDgSGcdmIv4ycVxyn"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.26.0/moment-with-locales.min.js"></script>




<!-- custom javascripts -->
<script src="{% static 'purchase/js/corrinas_purchase_javascript.js' %}"></script>
<script src="{% static 'purchase/js/script.js' %}"></script>
<script>
    $('#item_detail').on('click', 'input[type="button"]', function () {
        $(this).closest('tr').remove();
    })
    $('p input[type="button"]').click(function () {
        $('#myTable').append('<tr><td><input type="text" class="fname" /></td><td><input type="button" value="Delete" /></td></tr>')
    });
</script>

{# Update the files upload object #}
<script>
    $('#fileselect').on('click', function() {
        var upload = $(this);
        upload.clone().insertAfter(upload);
        upload.hide()
    });
</script>


<script>
    {#   var display_unit = []#}
    {# $(document).ready(function dropdown_uom(){#}
    {#   display_unit = []#}
    {#   $.getJSON( "{% url 'units_of_measure_api' %}",function (data) {#}
    {#        var options = '<option disabled selected value>-- select a unit --</option>';#}
    {#             for (var i = 0; i < data.length; i++) {#}
    {#                        display_unit.push(data[i])#}
    {#                 options += '<option value "' + data[i].the_unit + '">' + data[i].fields['the_unit'] + '</option>';#}
    {#        }#}
    {##}
    {#            $("select[name='unit_of_measurement']").html(options);#}
    {#             $("select[name='unit_of_measurement']").selectpicker('refresh');#}
    //{#});#}
    //{#});#}


    {#  var options = $("#unit_of_measurement_0");#}
    {#  $.getJSON("{% url 'units_of_measure_api' %}", function(response) {#}
    {#       $.each(response, function() {#}
    {#       options.append($("<option />").val(this.the_unit).text(this.the_desc));#}
    {#   });#}
    //{#});#}




    {#$(document).ready(function () {#}
    {#            $.ajax({#}
    {#                type: "POST",#}
    {#                url: "{% url 'units_of_measure_api' %}",#}
    {#                dataType: "json",#}
    {#                contentType: "application/json; charset=utf-8",#}
    {#                success: function (result) {#}
    {#$('#unit_of_measurement_0').empty();#}
    {#                    $('#unit_of_measurement_0').append("<option value='0'>---Select---</option>");#}
    {#                    $.each(result.unitofmeasurement, function (key, value) {#}
    {#                        $('#unit_of_measurement_0').append($("<option> </option>").val(key.this_unit).html(value.this_desc));#}
    {#                    });#}
    {#                }#}
    {#            });#}
    {#        });#}




</script>

<script>



    $(document).ready(function () {
        $('.selectpicker').selectpicker();
    });

    $(document).ready(function () {
        $(".numberinput").forceNumeric();
    });

    // forceNumeric() plug-in implementation Author:Josh
    jQuery.fn.forceNumeric = function () {
        return this.each(function () {
            $(this).keydown(function (e) {
                var key = e.which || e.keyCode;

                if (!e.shiftKey && !e.altKey && !e.ctrlKey &&
                    // numbers
                    key >= 48 && key <= 57 ||
                    // Numeric keypad
                    key >= 96 && key <= 105 ||
                    // comma, period and minus, . on keypad
                    key == 190 || key == 188 || key == 109 || key == 110 ||
                    // Backspace and Tab and Enter
                    key == 8 || key == 9 || key == 13 ||
                    // Home and End
                    key == 35 || key == 36 ||
                    // left and right arrows
                    key == 37 || key == 39 ||
                    // Del and Ins
                    key == 46 || key == 45)
                    return true;

                return false;
            });
        });
    };

</script>


<script>
    show_table();
    update_gl_descriptions();
    // Makes table show if item details are not none
    function show_table() {
        document.getElementById("item_detail").style.display = "block";
    }
    {% if purchase_request_form.isCompleted == True and details_to_edit == None %}
        make_fields_readonly({% if details_to_edit != None %}{{ details_to_edit }}{% else %}null{% endif %},
            {% if rows_to_approve != None %}
                [{% for row in rows_to_approve %}{{ row.pk }}, {% endfor %}],
                {% else %}null,{% endif %} '{{ request.session.department }}');
    {% endif %}
    function populate_gl_accounts(id) {
        document.getElementById(id).innerHTML = "{% for account in gl_accounts %}<option value='{{ account.glDescription }}'>{{ account.glCode }}</option>{% endfor %}";
    }

    function populate_departments(id) {
        document.getElementById(id).innerHTML = "{% for dept in departments %}<option title='{{ dept.costCenterCode }}' value='{{ dept.costCenterName }}'>{{ dept.costCenterName }}</option>{% endfor %}";
    }

    populate_departments('department_0');

    limitInput();
    try {
        update_plant_code();
    } catch (e) {
        console.log("no plant codes")
    }
    update_cost_center_code();

</script>

<script>
    function populate_uom(id){
        document.getElementById(id).innerHTML = " <option value='EA'>EA - each</option> {% for measure in measurement_unit %} <option title ='{{ measure.uom }}' value ='{{ measure.uom }}'> {{ measure.uom }} - {{ measure.uomDesc }}</option> {% endfor %}";
    }
    populate_uom('unit_of_measurement_0')
</script>

<script>
    generatepr();
</script>

{#<script>#}
{#        function populate_uom(id){#}
{#        document.getElementById(id).innerHTML = " <option> --Select Unit of Measurement--</option> {% for measure in measurement_unit %} <option title ='{{ measure.uom }}' value ='{{ measure.uomDesc }}'> {{ measure.uom }} - {{ measure.uomDesc }}</option> {% endfor %}";#}
{#    }#}
{#    populate_uom('unit_of_measurement_0')#}
{#</script>#}

{% if show_chat %}
    <script>
        const url = '{% url 'chat_api' %}';
        const form_id = '{{ form_id }}';
        const user_id = '{{ request.session.user_id }}';
        const form_type = '{{ form_type }}';
        const csrf_token = '{{ csrf_token }}';
        const chat_approver_url = '{%  url 'get_form_approver_api' %}'
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.11.0/underscore-min.js"
            type='text/javascript'></script>
    <script src="http://podio.github.io/jquery-mentions-input/lib/jquery.elastic.js" type='text/javascript'></script>
    <script src='http://podio.github.io/jquery-mentions-input/jquery.mentionsInput.js' type='text/javascript'></script>
    <script src="{% static 'office_app/js/chat.js' %}"></script>

{% endif %}
<script>
    $('#notify_users').click(function () {
        Swal.fire({
            title: 'Notify Users',
            input: 'text',
            inputAttributes: {
                autocapitalize: 'off'
            },
            showCancelButton: true,
            confirmButtonText: 'Notify',
            showLoaderOnConfirm: true,

            allowOutsideClick: () => !Swal.isLoading()
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire({
                    title: `${result.value.login}'s avatar`,
                    imageUrl: result.value.avatar_url
                })
            }
        })

    });
</script>

<script>
    $('#print_form').click(function () {
        let form_data = $('#msform').serialize();
        $.ajax({
            url: "{% url 'print_pr' %}?" + form_data,
            type: "GET",
            xhrFields: {
                responseType: 'blob'
            },
            beforeSend: function (xhr) {
                Swal.fire({
                    text: 'Working...',
                    icon: 'info',
                    showCancelButton: false,
                    showConfirmButton: false,
                    allowEscapeKey: true,
                    allowOutsideClick: false
                })
            },
            success: function (response) {
                var link = document.createElement('a');
                link.href = window.URL.createObjectURL(response);
                link.download = "my_purchase_form.pdf";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                swal.close()
            },
            error: function (err, msg) {
                Swal.fire({
                    text: 'Error printing form. Please contact I.T department',
                    icon: 'error',
                })
            }
        })
    });
</script>







<!-- Vendor autocomplete --->
{#<script>#}
{#    var vendors =#}
{#        [#}
{#            {% for vendor in vendors %}#}
{#                '{{ vendor }}',#}
{#            {% endfor %}#}
{#        ];#}
{##}
{#    /*initiate the autocomplete function*/#}
{#    autocomplete(document.getElementById("vendor_name"), vendors);#}
{#    autocomplete(document.getElementById("vendor_name"), vendors);#}
{##}
{#    var vendor_objects = [#}
{#        {% for vendor in vendors %}#}
{#            {#}
{#                'vendorName': '{{ vendor.vendorName }}',#}
{#                'vendorCode': '{{ vendor.vendorCode }}',#}
{#                'supplierTelephone': '{{ vendor.supplierTelephone }}',#}
{#                'supplierAddress': '{{ vendor.supplierAddress }}',#}
{#                'pk': '{{ vendor.pk }}'#}
{#            },#}
{#        {% endfor %}#}
{#    ];#}
{##}
{#    function update_vendor() {#}
{#        var vendorName = document.getElementById('vendor_name').value;#}
{#        console.log("vendor name is: " + vendorName);#}
{##}
{#        for (let i = 0; i < vendor_objects.length; i++) {#}
{#            console.log("vendor object: " + vendor_objects[i].toString());#}
{#            if (vendor_objects[i]['vendorName'] === vendorName){#}
{#                document.getElementById('vendor_code').value = vendor_objects[i]['vendorCode'];#}
{#                document.getElementById('contact').value = vendor_objects[i]['supplierTelephone'];#}
{#                document.getElementById('address').value = vendor_objects[i]['supplierAddress'];#}
{#            }#}
{#        }#}
{#    }#}
{##}
{#</script>#}
{#<option class="form-control" {% if vendor.pk == supplier_info.vendor.pk %}selected{% endif %}#}
{#                                                        value="{{ vendor.pk }}" id="{{ vendor.vendorCode }}/-/{{ vendor.supplierTelephone}}/-/{{ vendor.supplierAddress }}">{{ vendor.vendorName }}</option>#}
</body>

</html>
