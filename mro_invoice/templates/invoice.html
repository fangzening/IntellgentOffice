<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>Foxconn - MRO - Invoice Form</title>

    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/12.1.2/css/intlTelInput.css'>
    <link rel='stylesheet' href='https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css'>
    <link rel='stylesheet'
          href='https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.min.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/emojionearea/3.4.2/emojionearea.css"/>
    <link rel="stylesheet" href="{% static 'office_app/css/chat.css' %}">
    <!-- font icon -->
    <link href="{% static 'mro_invoice/css/elegant-icons-style.css' %}" rel="stylesheet"/>
    <!-- Custom styles -->
    <link href="{% static 'mro_invoice/css/style2.css' %}" rel="stylesheet">
    <link href="{% static 'mro_invoice/css/style-responsive.css' %}" rel="stylesheet"/>

</head>

<body class="pr_form">

{% if show_chat %}
    <div class="container chat-container">
        <div class="row">
            <div class="chat-block col-md-3">
                <div class="card card-primary text-secondary">
                    <div class="card-header p-2" id="accordion">
                        <i id="chat-badge" class="fas fa-comment pl-2"></i> Chat
                        <div class="btn-group float-right pr-2">
                            <a type="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                                <i id="toggle_icon" class="fas fa-arrow-down"></i>
                            </a>
                        </div>
                    </div>
                    <div class="card-collapse collapse show" id="collapseOne">
                        <div class="card-header text-center text-info p-1">Chat for GR Form: {{ form_id }}</div>
                        <div id="chat-body" class="card-body card-body-chat">
                            <ul class="chat" id="chat_list"></ul>
                        </div>
                        <div class="card-footer p-2">
                            <div class="input-group" style="flex-wrap: nowrap">
                                <textarea id="chat-input" type="text" class="form-control form-control-sm"
                                          placeholder="Type your message here..."></textarea>
                                <i class="btn fas fa-level-down-alt text-primary" id="chat-scroll"
                                   title="Auto scroll on new message"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}

<!-- Multi step form -->
<section class="multi_step_form">
    <form id="msform" name="msform" method="POST">
        {% csrf_token %}
        <!-- Tittle -->
        <div class="tittle">
            <h1>Foxconn MRO - Invoice Form</h1>
            {% if invoice_form.isDeclined %}
                <h2 style="color: red">This Form has been Declined{% if current_employee == pr_form.employee %} but you can edit it and submit it again{% endif %}</h2>
            {% elif invoice_form.isApproved %}
                <h2 style="color: limegreen">This Form has been Completely Approved</h2>
            {% endif %}
        </div>
        <!--menu bar-->
        <nav class="navbar navbar-expand-lg navbar-light  bg-light rounded nav nav-tabs">
            <a class="ml-5 h7">Welcome, {{ request.session.full_name }} !</a>

            <div class="collapse navbar-collapse justify-content-end " id="navbarNavDropdown">
                <ul class="nav nav-pills nav-fill" style="float: right">

                    <li class="nav-item">
                        <a href="{% url 'smart_office_dashboard' %}" class="nav-link">Smart Office</a>
                    </li>

                    <li class="nav-item mr-sm-2">
                        <a href="{% url 'logout' %}" class="nav-link">Log Out</a>
                    </li>


                </ul>
            </div>
        </nav>

        <!-- fieldsets -->
        <fieldset>
            <div class="mt-3">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Form Information
                            </header>
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group col-md-4 float-left">
                                        <label for="requestor">Requestor</label>
                                        <input type="text" class="form-control" id="requestor" name="requestor"
                                               placeholder="Requestor" value="{{ gr_forms.0.requester }}" readonly
                                        >
                                    </div>
                                    <div class="form-group col-md-4">

                                    </div>
                                    <div class="form-group col-md-4 float-right">
                                        <label for="sap_invoice">SAP Invoice:</label>
                                        <input class="form-control" id="sap_invoice" name="sap_invoice"
                                               placeholder="SAP Invoice" readonly {% if invoice_form.sapInvoiceNo != None %}value="{{ invoice_form.sapInvoiceNo }}"{% endif %}>
                                    </div>
                                    <div class="form-group col-md-4 float-left">
                                        <label for="creation_date">Creation Date</label>
                                        <input type="date" class="form-control" id="creation_date" name="creation_date"
                                               {% if invoice_form.creationDate != None %}value="{{ invoice_form.creationDate|date:'Y-m-d' }}" {% endif %}readonly>
                                    </div>
                                    <div class="form-group col-md-4">

                                    </div>


                                    <div class="form-group col-md-4 float-right">
                                        <label for="sap_acc_doc">SAP Account Document Number:</label>
                                        <input type="text" class="form-control" id="sap_acc_doc" name="sap_acc_doc"
                                                {% if invoice_form.sapAccDocNo != None %} value="{{ invoice_form.sapAccDocNo }}"{% endif %}
                                               readonly placeholder="will be populated once both users approve GR">
                                    </div>
                                </div>
                            </div>

                        </section>
                    </div>
                </div>
            </div>

            <hr>


            <div class="mt-3">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Basic Information
                            </header>
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group col-md-3 ">
                                        <label for="company">Company</label>
                                        <input type="text" class="form-control" id="company" name="company"
                                               placeholder="Company" value="{{ request.user.employee.legalEntity }}"
                                               readonly
                                        >
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="business_group">Business Group</label>
                                        <input type="text" class="form-control" id="business_group"
                                               name="business_group"
                                               placeholder="Business Group" value="{{ request.user.employee.businessGroup }}"
                                               readonly
                                        >
                                    </div>
                                    <div class="form-group col-md-3 ">
                                        <label for="business_unit">Business Unit:</label>
                                        <input class="form-control" id="business_unit" name="business_unit"
                                               placeholder="Business Unit" value="{{ request.user.employee.businessUnit }}"
                                               readonly
                                        >
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="plant">Plant</label>
                                        <input type="text" class="form-control" id="plant" name="plant"
                                               value="{{ request.user.employee.businessUnit.plantCode }}"
                                               readonly
                                        >
                                    </div>

                                    <div class="form-group col-md-12 float-right">
                                        <label for="memo">Memo:</label>
                                        <textarea type="" class="form-control" id="memo" name="memo"
                                        >{% if invoice_basic_info.memo != None %}{{invoice_basic_info.memo}}{% endif %}</textarea>
                                    </div>
                                </div>
                            </div>

                        </section>
                    </div>
                </div>
            </div>
            <hr>


            <div class="mt-3">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Invoice Information
                            </header>
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group col-md-4 ">
                                        <label for="invoice_date">Invoice Date:</label>
                                        <input type="date" class="form-control" id="invoice_date" name="invoice_date"
                                        {% if invoice_info.invDate != None %}value="{{ invoice_info.invDate | date:'Y-m-d' }}"{% endif %}>
                                    </div>
                                    <div class="form-group col-md-4">

                                    </div>
                                    <div class="form-group col-md-4 ">
                                        <label for="total_gr_amount">GR Amount (Auto-Filled from selected GR item):</label>
                                        <input class="form-control" id="total_gr_amount" name="total_gr_amount" onkeyup="calculate_tax_rate(); calculate_balance();"
                                               placeholder="Amount" value="{{ total_gr_amount }}" readonly >
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="invoice_number">Invoice Number:</label>
                                        <input type="number" class="form-control" id="invoice_number" placeholder="Will be populated by SAP"
                                               name="invoice_number" readonly {% if invoice_form.sapInvoiceNo != None %}value="{{ invoice_form.sapInvoiceNo }}"{% endif %}>
                                    </div>
                                    <div class="form-group col-md-4">

                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="tax_amount">Tax Amount:</label>
                                        <input onkeyup="calculate_tax_rate();  calculate_balance();" type="number" class="form-control numberinput" id="tax_amount" name="tax_amount" {% if invoice_info.taxAmount != None and  invoice_info.taxAmount != 0.00 %} value="{{  invoice_info.taxAmount }}" {% else %}value="0"{% endif %}>
                                    </div>

                                    <div class="form-group col-md-4 ">
                                        <label for="invoice_amount">Invoice Amount:</label>
                                        <input type="text" class="form-control numberinput" id="invoice_amount"
                                               name="invoice_amount" {% if invoice_info.invAmount != None %}value="{{ invoice_info.invAmount }}" {% else %}value="0"{% endif %}>
                                    </div>
                                    <div class="form-group col-md-4">

                                    </div>
                                    <div class="form-group col-md-4 ">
                                        <label for="shipping_fee">Shipping Fee:</label>
                                        <input type="number" class="form-control numberinput" id="shipping_fee" name="shipping_fee" onkeyup="calculate_tax_rate(); calculate_balance();"
                                               {% if invoice_info.shippingFee != None %}value="{{ invoice_info.shippingFee }}" {% else %}value="0"{% endif %}>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="balance">Balance:</label>
                                        <input type="number" class="form-control" id="balance" name="balance" readonly>
                                    </div>
                                    <div class="form-group col-md-4">

                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="tax_rate">Tax Rate:</label>
                                        <input type="number" readonly class="form-control numberinput" id="tax_rate" name="tax_rate">
                                    </div>

                                    <div class="form-group col-md-4">
                                        <label for="invoice_text">Invoice Text:</label>
                                        <input class="form-control" id="invoice_text" name="invoice_text" {% if invoice_info.invoiceText != None %}value="{{ invoice_info.invoiceText }}"{% endif %} >
                                    </div>
                                    <div class="form-group col-md-4">

                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="use_tax">Use Tax:</label><br>
                                        <div id="yes">
                                            <input type="radio" name="use_tax_bool" value="yes"
                                                   {% if invoice_info.useTax %}checked="checked"{% endif %} onclick="document.getElementById('use_tax').value='yes';">
                                            <label for="yes">Yes</label>
                                            <br></div>
                                        <div id="no">
                                            <input type="radio" name="use_tax_bool" value="no"
                                                   {% if invoice_info.useTax == False %}checked="checked"{% endif %} onclick="document.getElementById('use_tax').value='no';">
                                            <label for="no">No</label><br>
                                        </div>
                                        <input class="form-control" hidden readonly name="use_tax" id="use_tax" {% if invoice_info.useTax == True %} value="yes" {% elif invoice_info.useTax == False %} value="yes" {% endif %}>
                                    </div>

                                </div>
                            </div>

                        </section>
                    </div>
                </div>
            </div>
            <hr>
            <div class="mt-3">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Vendor Information
                            </header>
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group col-md-4 float-left">
                                        <label for="vendor_code">Vendor Code</label>
                                        <input type="text" class="form-control" id="vendor_code" name="vendor_code"
                                               placeholder="Vendor Code" value="{{ supplier_info.vendor.vendorCode }}" readonly
                                        >
                                    </div>
                                    <div class="form-group col-md-4">

                                    </div>
                                    <div class="form-group col-md-4 float-right">
                                        <label for="vendor_name">Vendor Name:</label>
                                        <input class="form-control" id="vendor_name" name="vendor_name"
                                               placeholder="Vendor Name" value="{{ supplier_info.vendor }}" readonly>
                                    </div>

                                </div>
                            </div>

                        </section>
                    </div>
                </div>
            </div>
            <hr>
            <div class="">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Open GR List
                            </header>
                            <div class="card-body">

                                <div class="table-responsive-xl">
                                    <table class="table">
                                        <thead>
                                        <tr>
                                            <th>
                                                PO Number
                                            </th>
                                            <th>
                                                GR Number
                                            </th>
                                            <th>
                                                Cost Center
                                            </th>
                                            <th>
                                                Cost Center Name
                                            </th>
                                            <th>
                                                GL Account
                                            </th>
                                            <th>
                                                GL Name
                                            </th>
                                            <th>
                                                Description
                                            </th>
                                            <th>
                                                Quantity
                                            </th>
                                            <th>
                                                Amount
                                            </th>
                                            <th>
                                                Asset number
                                            </th>
                                            {% if invoice_form.currentStage == 0 %}
                                                <th>
                                                    Remove
                                                </th>
                                            {% endif %}
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for item in gr_lists %}
                                        <tr id="item_{{ item.pk }}" name="item_row">
                                            <td><input class="form-control" type="text" id="po_number"
                                                       placeholder="Auto-filled" name="po_number" readonly
                                                       value="{{ po_num }}"></td>
                                            <td><input class="form-control" type="text" id="gr_number" name="gr_number"
                                                       readonly value="{{ item.grNo }}"></td>
                                            <td><input class="form-control" type="text" id="cost_center"
                                                       name="cost_center" readonly value="{{ item.purchaseItem.costCenterCode.costCenterCode }}"></td>
                                            <td><input class="form-control" id="cc_name" name="cc_name"
                                                       readonly value="{{ item.purchaseItem.costCenterCode }}"></td>
                                            <td><input class="form-control" id="gl_account" name="gl_account" value="{{ item.purchaseItem.glAccount.glCode }}" readonly></td>
                                            <td><input class="form-control" id="gl_name"
                                                       name="gl_name" value="{{ item.purchaseItem.glAccount }}"
                                                       readonly></td>

                                            <td><textarea class="form-control" id="description"
                                                          name="description"
                                                          readonly>{{item.purchaseItem.itemDesc}}</textarea></td>
                                            <td><input type="number" class="form-control" id="quantity" name="quantity" value="{{ item.grQuantity }}" readonly
                                            ></td>
                                            <td><input type="number" class="form-control" id="amount" name="amount" value="{{ item.purchaseItem.unitPrice }}" readonly
                                            ></td>
                                            <td><input class="form-control" id="asset_number"
                                                       name="asset_number"
                                                       readonly ></td>
                                            {% if invoice_form.currentStage == 0 %}
                                                <td>
                                                    <button type="button" class="btn btn-danger btn-group delete"
                                                                data-toggle="tooltip" data-placement="top" name="delete_row" id="delete_row_{{ item.pk }}"
                                                                title="Delete Row" onclick="delete_gr_item('{{ item.pk }}');">
                                                            <i class="icon_trash"></i>
                                                        </button>
                                                </td>
                                            {% endif %}
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>

                                </div>


                            </div>
                        </section>
                    </div>
                </div>
            </div>


            <hr>
            <div class="">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                MRO Invoice Attachment
                            </header>
                            <div class="card-body">
                                <div class="table-responsive-xl">
                                    <table class="table">
                                        <thead>
                                        <tr>
                                            <th>
                                                File Name
                                            </th>
                                            <th>
                                                Auto Link
                                            </th>
                                            <th>
                                                Upload
                                            </th>
                                        </thead>
                                        <tbody>
                                        {% if invoice_form.isApproved == False %}
                                            <input type="submit" name="btn_submit"
                                                       class="btn btn-white ml-auto" id="btn_upload" value="Upload Chosen Files" onclick="return set_submit_button('upload files');"/>
                                        {% endif %}
                                        <tr>
                                            <td>PR</td>
                                            <td id="pr_file_list">

                                                <button type="button"
                                                        class="btn btn-link"
                                                        name="pr_file" value="Download PR printable Version"
                                                        id="pr_file">Download PR printable Version
                                                </button>
                                                {% for file in files %}
                                                    {% if 'purchase_request' in file.location %}
                                                        <br>
                                                        <a href="{% get_media_prefix %}{{ file.location }}/{{ file.fileName }}"
                                                        target="_blank">{{ file.fileName }}</a>
                                                    {% endif %}
                                                {% endfor %}
                                            </td>
                                            <td>
                                                <input type="file"
                                                        class="btn btn-secondary btn-group"
                                                        name="pr_file" value="Upload PR Version"
                                                        id="pr_file">
{#                                                <input type="submit" name="btn_submit"#}
{#                                                       class="btn btn-white ml-auto" id="btn_upload_pr" value="Upload File" onclick="return set_submit_button('upload_pr_file');"/>#}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>PO</td>
                                            <td id="po_file_list">
                                                <div id="po_doc_link">
                                                    {% if po_doc_link != None %}
                                                        <a href="{{ po_doc_link }}" target="_blank">Download PO printable Version</a>
                                                    {% else %}
                                                        <button type="submit" class="btn btn-link" onclick="set_submit_button('generate_po_doc');">Generate PO document</button>
                                                    {% endif %}
                                                </div>
                                                {% for file in files %}
                                                    {% if 'po_files' in file.location %}
                                                        <br>
                                                        <a href="{% get_media_prefix %}{{ file.location }}/{{ file.fileName }}" target="_blank">{{ file.fileName }}</a>
                                                    {% endif %}
                                                {% endfor %}
                                            </td>
                                            <td>
                                                <input type="file"
                                                        class="btn btn-secondary btn-group"
                                                        name="po_file" value="Upload SAP PO"
                                                        id="po_file">
{#                                                <input type="submit" name="btn_submit"#}
{#                                                       class="btn btn-white ml-auto" id="btn_upload_po" value="Upload File" onclick="return set_submit_button('upload_po_file');"/>#}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>GR</td>
                                            <td id="gr_file_list">
                                                <button type="button"
                                                        class="btn btn-link"
                                                        name="gr_file" value="Download GR printable Version"
                                                        id="gr_file">Download GR printable Version
                                                </button>
                                                {% for file in files %}
                                                    {% if 'goods' in file.location %}
                                                        <br>
                                                        <a href="{% get_media_prefix %}{{ file.location }}/{{ file.fileName }}"
                                                        target="_blank">{{ file.fileName }}</a>
                                                    {% endif %}
                                                {% endfor %}
                                            </td>
                                            <td>
                                                <input type="file"
                                                        class="btn btn-secondary btn-group"
                                                        name="gr_file" value="Upload SAP GR"
                                                        id="gr_file">
{#                                                <input type="submit" name="btn_submit"#}
{#                                                       class="btn btn-white ml-auto" id="btn_upload_gr" value="Upload File" onclick="return set_submit_button('upload_gr_file');"/>#}
                                            </td>
                                        </tr>

                                        <tr>
                                            <td>Invoice</td>
                                            <td id="invoice_file_list">
                                                {% for file in files %}
                                                    {% if 'invoice' in file.location %}
                                                        <br>
                                                        <a href="{% get_media_prefix %}{{ file.location }}/{{ file.fileName }}"
                                                        target="_blank">{{ file.fileName }}</a>
                                                    {% endif %}
                                                {% endfor %}
                                            </td>
                                            <td>
                                                <input type="file"
                                                        class="btn btn-secondary btn-group"
                                                        name="invoice_file" value="Invoice Upload"
                                                        id="invoice_file">
{#                                                <input type="submit" name="btn_submit"#}
{#                                                       class="btn btn-white ml-auto" id="btn_upload_invoice" value="Upload File" onclick="return set_submit_button('upload_invoice_file');"/>#}
                                            </td>
                                        </tr>

                                        <tr>
                                            <td>Acceptance Report (Optional) </td>
                                            <td id="ar_file_list">
                                                Construction and Equipment must attach
                                                {% for file in files %}
                                                    {% if 'acceptance' in file.location %}
                                                        <br>
                                                        <a href="{% get_media_prefix %}{{ file.location }}/{{ file.fileName }}"
                                                        target="_blank">{{ file.fileName }}</a>
                                                    {% endif %}
                                                {% endfor %}
                                            </td>
                                            <td>
                                                <input type="file"
                                                        class="btn btn-secondary btn-group"
                                                        name="ar_file" value="Acceptance Report"
                                                        id="ar_file">
{#                                                 <input type="submit" name="btn_submit"#}
{#                                                       class="btn btn-white ml-auto" id="btn_upload_ar" value="Upload File" onclick="return set_submit_button('upload_ar_file');"/>#}
                                            </td>
                                        </tr>

                                        <tr>
                                            <td>Packing Slip (Optional)</td>
                                            <td id="ps_file_list">
                                            Auto Attach
                                                {% for file in files %}
                                                    {% if 'packaging' in file.location %}
                                                        <br>
                                                        <a href="{% get_media_prefix %}{{ file.location }}/{{ file.fileName }}"
                                                        target="_blank">{{ file.fileName }}</a>
                                                    {% endif %}
                                                {% endfor %}
                                            </td>
                                            <td>
                                                <input type="file"
                                                        class="btn btn-secondary btn-group"
                                                        name="ps_file" value="Packing Slip"
                                                        id="ps_file">
{#                                                 <input type="submit" name="btn_submit"#}
{#                                                       class="btn btn-white ml-auto" id="btn_upload_ps" value="Upload File" onclick="return set_submit_button('upload_ps_file');"/>#}
                                            </td>
                                        </tr>


                                        </tbody>
                                    </table>


                                </div>



                            </div>


                        </section>
                    </div>
                </div>
            </div>
            <hr>
            <div class="panel panel-default">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="card">
                            <header class="card-header bg-foxconn">
                                Approver List
                            </header>
                            <div class="card-body">
                                <table class="table">
                                    <thead>
                                    <tr>
                                        <th>
                                            Approver
                                        </th>
                                        <th>
                                            Action
                                        </th>
                                        <th>
                                            Action Date
                                        </th>
                                        <th>
                                            Comment
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                         <td>
                                            <input type="text" class="form-control" id="scm"
                                                   name="scm" readonly value="{{ invoice_form.employeeID }}">
                                        </td>
                                    {% if invoice_form.currentStage == 0 %}
                                        <td>
                                            <input type="submit" name="btn_submit" {% if current_user != invoice_form.employeeID %} hidden {% endif %}
                                                       class="btn btn-white ml-auto" id="btnsave" value="Save Changes" onclick="return set_submit_button('Save');"/>
                                            <input type="submit" name="btn_submit" {% if current_user != invoice_form.employeeID %} hidden {% endif %}
                                                       class="btn btn-success ml-auto" id="btnsubmit" value="Submit" onclick="return set_submit_button('Submit');"/>
                                        </td>
                                    {% else %}
                                        <td>
                                            Submitted
                                        </td>
                                        <td>
                                            {{ stages.0.dayAssigned }}
                                        </td>
                                    {% endif %}
                                    </tr>
                                    {% for stage in stages %}
                                        <tr>
                                             <td>
                                                <input type="text" class="form-control" id="scm"
                                                       name="scm" readonly value="{{ stage.approverID }}">
                                            </td>

                                            <td>
                                                {% if stage.stage == invoice_form.currentStage and stage.approverID == current_user %}
                                                    <input type="submit" name="btn_submit"
                                                               class="btn btn-success ml-auto" id="stage_{{ stage.stage }}_btn_approve" value="Approve" onclick="return set_submit_button('Approve');"/>
                                                    <input type="submit" name="btn_submit"
                                                               class="btn btn-danger ml-auto" id="stage_{{ stage.stage }}_btn_decline" value="Decline" onclick="return set_submit_button('Decline');"/>
                                                {% else %}
                                                    {% if stage.actionTaken != None and stage.actionTaken != '' %}{{ stage.actionTaken }}{% endif %}
                                                {% endif %}
                                            </td>

                                            <td>
                                                {% if stage.stage == invoice_form.currentStage and stage.approverID == current_user %}
                                                    <input type="date" class="form-control" id="stage_{{ stage.stage }}_action_date" readonly
                                                           name="action_date" value="{{ todays_date | date:'Y-m-d' }}">
                                                {% else %}
                                                    {% if stage.date != None %}{{ stage.date }}{% endif %}
                                                {% endif %}
                                            </td>

                                            <td>
                                            {% if stage.stage == invoice_form.currentStage and stage.approverID == current_user %}
                                                <textarea class="form-control" id="stage_{{ stage.stage }}_comment" {% if stage.stage != invoice_form.currentStage %} readonly {% endif %}
                                                          name="comment">{%if stage.comment != None%}{{stage.comment}}{%endif%}</textarea>
                                            {% else %}
                                                {% if stage.comments != None %}{{ stage.comments }}{% endif %}
                                            {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
            <input hidden readonly id="submit_button" name="submit_button">
{#            <input hidden readonly id="employee_name" name="employee_name" value="{{ request.session.full_name }}">#}
        </fieldset>

        <!-- End Multi step form -->
    </form>
</section>
<!-- JS Scripts -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/12.1.2/js/intlTelInput.js'></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/js/jquery.nice-select.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js'></script>
<script src="https://cdn.jsdelivr.net/npm/promise-polyfill"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.3.0/jquery.form.min.js"
        integrity="sha384-qlmct0AOBiA2VPZkMY3+2WqkHtIQ9lSdAsAn5RUJD/3vA5MKDgSGcdmIv4ycVxyn"
        crossorigin="anonymous"></script>
<!--Moments Js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.26.0/moment-with-locales.min.js"></script>
<!--Emoji Js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/emojionearea/3.4.2/emojionearea.js"></script>

<!-- custom javascripts -->

<script src="{% static 'mro_invoice/js/script.js' %}"></script>
<script src="{% static 'mro_invoice/js/corrinas_Invoice_javascript.js' %}"></script>


<script>
    $('#item_detail').on('click', 'input[type="button"]', function () {
        $(this).closest('tr').remove();
    })
    $('p input[type="button"]').click(function () {
        $('#myTable').append('<tr><td><input type="text" class="fname" /></td><td><input type="button" value="Delete" /></td></tr>')
    });
</script>


<script>
    $(document).ready(function () {
        $(".numberinput").forceNumeric();
    });

    // forceNumeric() plug-in implementation Author:Josh
    jQuery.fn.forceNumeric = function () {
        return this.each(function () {
            $(this).keydown(function (e) {
                var key = e.which || e.keyCode;

                if (!e.shiftKey && !e.altKey && !e.ctrlKey &&
                    // numbers
                    key >= 48 && key <= 57 ||
                    // Numeric keypad
                    key >= 96 && key <= 105 ||
                    // comma, period and minus, . on keypad
                    key == 190 || key == 188 || key == 109 || key == 110 ||
                    // Backspace and Tab and Enter
                    key == 8 || key == 9 || key == 13 ||
                    // Home and End
                    key == 35 || key == 36 ||
                    // left and right arrows
                    key == 37 || key == 39 ||
                    // Del and Ins
                    key == 46 || key == 45)
                    return true;

                return false;
            });
        });
    };
</script>

{% if show_chat %}
    <script>
        const url = '{% url 'chat_api' %}';
        const form_id = '{{ form_id }}';
        const user_id = '{{ request.session.user_id }}';
        const form_type = '{{ form_type }}';
        const csrf_token = '{{ csrf_token }}';
    </script>
    <script src="{% static 'office_app/js/chat.js' %}"></script>
{% endif %}


{% if invoice_form.currentStage != 0 %}
<script>
    user_cannot_edit_form();
</script>
{% endif %}

<script>
    calculate_tax_rate();
    calculate_balance();
</script>

{# allow approver to upload files somehow #}


</body>

</html>
